import{u as a,g as e,w as s}from"../element-plus/element-plus.372e8740.js";import{G as l,ax as t,d as o,Z as i,P as n,c as r,U as c,O as u,u as p,o as m,F as v,a7 as d,a as h,T as g,a2 as y,z as f}from"../@vue/@vue.7ad02ad1.js";import{u as j}from"../vue-router/vue-router.53ff932e.js";import{g as R,c as w,B as b,f as E,h as _,C as k,D as O,_ as U}from"../../assets/index-0cefdbff.js";import{T as z}from"../Tab/Tab.8cc6d4ba.js";import{P as C}from"../PlayList/PlayList.642f3bde.js";import{L as I}from"../Loading/Loading.219459e7.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../pinia/pinia.07d51cb2.js";import"../nprogress/nprogress.8c6d26c7.js";import"../lodash/lodash.57b1d944.js";const L=["infinite-scroll-disabled"],T={class:"title"},x={class:"content"},P=["onMousedown"],F=U(l({__name:"MusicHall",setup(l){t((a=>({"6816577e":p(F),"173c7d34":p(G)})));const U=j(),F=R().get("fontColor"),G=R().get("shadow");R().get("background");const M=o(!1),N=o(!1),q=f("firstLoading"),A=f("hideScroll"),B=o("top"),D=o(48),H=o(24),S=i([]),Z=i([]),J=o(1),K=i([]),Q=i([]),V=()=>{"top"==B.value?W():"hot"==B.value&&Y()},W=()=>{N.value=!0,M.value=!0,setTimeout((()=>{H.value+=12,H.value<=S.length?(Z.push(...S.slice(Z.length,H.value)),N.value=!1,M.value=!1):D.value==S.length?(D.value*=2,X()):(Z.push(...S.slice(Z.length)),N.value=!1,E(_.INFO,"已经到底底部！"))}),1e3)},X=()=>{w((async()=>{try{const a=await k(D.value),{playlists:e}=a;e.slice(S.length).forEach((a=>{const{name:e,id:s,coverImgUrl:l,playCount:t,description:o,tags:i,creator:n}=a;S.push({name:e,id:s,playCount:t,description:o,image:l,tag:i,creator:{avatarUrl:n.avatarUrl,nickname:n.nickname}})})),Z.push(...S.slice(Z.length,H.value))}catch(a){E(_.ERROR,a.message)}N.value=!1,M.value=!1}),N)},Y=()=>{J.value<K.length?(N.value=!0,M.value=!0,setTimeout((async()=>{$(K[J.value].id),N.value=!1,M.value=!1,J.value++}),1e3)):(M.value=!0,E(_.INFO,"已达到底部"))},$=a=>{w((async()=>{try{const e=await O(a),{data:{playlist:s}}=e,l=i([]);s.forEach((a=>{const{id:e,name:s,cover:t}=a;l.push({id:e,name:s,cover:t})})),Q.push(l)}catch(e){E(_.ERROR,e.message)}}))},aa=a=>{A(),B.value=a,"hot"==a&&0==K.length&&w((async()=>{try{const a=await b(),{data:e}=a;e.forEach(((a,e)=>{const{tagId:s,tagName:l}=a;K.push({id:s,name:l}),e<J.value&&$(s)}))}catch(a){E(_.ERROR,a.message)}q.value=!1}),q)};return w((async()=>{try{const a=await k(D.value),{playlists:e}=a;e.forEach((a=>{const{name:e,id:s,coverImgUrl:l,playCount:t,description:o,tags:i,creator:n}=a;S.push({name:e,id:s,playCount:t,description:o,image:l,tag:i,creator:{avatarUrl:n.avatarUrl,nickname:n.nickname}})})),Z.push(...S.slice(0,H.value)),q.value=!1}catch(a){E(_.ERROR,a.message)}}),q),(l,t)=>{const o=a,i=e,p=s;return n((m(),r("div",{class:"music-hall-container scroll-container","infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":M.value,style:{overflow:"auto"}},[c(z,{active:"top",onGetActive:aa},{content:u((()=>[c(o,{label:"精选歌单",name:"top"},{default:u((()=>[c(C,{playlists:Z},null,8,["playlists"]),c(I,{"is-loading":N.value},null,8,["is-loading"])])),_:1}),c(o,{label:"精选曲风",name:"hot"},{default:u((()=>[(m(!0),r(v,null,d(K.slice(0,J.value),((a,e)=>(m(),r("div",{key:a.id,class:"style-container"},[h("h4",T,g(a.name),1),h("div",x,[(m(!0),r(v,null,d(Q[e],(a=>(m(),r("div",{key:a.id,class:"style"},[h("span",{class:"iconfont play",onMousedown:y((e=>{return s=a.id,A(),void U.push({name:"playlist",query:{id:s+""}});var s}),["prevent"])},"",40,P),c(i,{src:a.cover,loading:"lazy"},null,8,["src"]),h("span",null,g(a.name),1)])))),128))])])))),128)),c(I,{"is-loading":N.value},null,8,["is-loading"])])),_:1})])),_:1})],8,L)),[[p,V]])}}}),[["__scopeId","data-v-cfaf0db5"]]);export{F as default};
