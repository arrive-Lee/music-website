import{u as a}from"../element-plus/element-plus.372e8740.js";import{G as s,i as e,d as l,Z as t,c as n,P as o,V as i,U as r,u,O as m,o as c,a as p,z as g}from"../@vue/@vue.7ad02ad1.js";import{b as d}from"../vue-router/vue-router.47595bf3.js";import{s as v}from"../pinia/pinia.07d51cb2.js";import{a as h,p as y,b as f,q as j,e as _,d as b,r as R,t as L,i as w,j as E,v as S,w as O,_ as C}from"../../assets/index-fcee7360.js";import{_ as x}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.5a65eb49.js";import{T as B}from"../Tab/Tab.efddb4a3.js";import{O as M}from"../OnlineBatch/OnlineBatch.130faf6a.js";import{P}from"../PlayButton/PlayButton.52d9fbab.js";import{D as z}from"../DecoratedButton/DecoratedButton.47c849d5.js";import{M as A}from"../Mv/Mv.62768b13.js";import{A as I}from"../Albums/Albums.f737a384.js";import{P as T}from"../PlayList/PlayList.df2cfed4.js";import{S as U}from"../Singer/Singer.76dca3da.js";import{L as k}from"../Loading/Loading.399d728c.js";import{N}from"../NoSearch/NoSearch.0ba97579.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const D={class:"search-container scroll-container"},G={class:"song"},V={class:"header-operation"},q={class:"singers"},F=C(s({__name:"SearchView",setup(s){const C=h(),{loveMusicId:F,loveSongs:H}=v(C),W=y(),{isFullScreen:Z}=v(W),J=e((()=>Z.value?"580px":"440px")),K=l(!1),Q=a=>{K.value=a},X=()=>{$.forEach((a=>{a.isLove=!0;null==F.value.get(a.id)&&H.value.push(a)})),S(O.LOCAL,"loveSongs",H.value)},Y=d().query.keyWord+"",$=t([]),aa=e((()=>new Map($.map(((a,s)=>[a.id,s]))))),sa=t([]),ea=t([]),la=t([]),ta=t([]),na=t([]),oa=l(!1),ia=g("firstLoading"),ra=g("hideScroll"),ua=t([!1,!1,!1,!1,!1]),ma=a=>{ra(),"video"==a&&0==sa.length?f((async()=>{try{const a=await j(1014,60,Y),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:n}=a;sa.push({id:s,name:e,image:l,artist:t[0].userName,playCount:n})}))}catch(a){_(b.ERROR,a.message)}oa.value=!1,ua[0]=0==sa.length}),oa):"mv"==a&&0==ea.length?f((async()=>{try{const a=await j(1004,60,Y),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:n}=a;ea.push({id:s,name:e,image:l,artist:t,playCount:n})}))}catch(a){_(b.ERROR,a.message)}oa.value=!1,ua[1]=0==ea.length}),oa):"album"==a&&0==la.length?f((async()=>{try{const a=await j(10,60,Y),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:n}=a;la.push({id:s,name:e,cover:l,publishTime:R(t),artistId:n.id})}))}catch(a){_(b.ERROR,a.message)}oa.value=!1,ua[2]=0==ea.length}),oa):"playList"==a&&0==ta.length?f((async()=>{try{const a=await j(1e3,60,Y),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;ta.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){_(b.ERROR,a.message)}oa.value=!1,ua[3]=0==ea.length}),oa):"singer"==a&&0==na.length&&f((async()=>{try{const a=await j(100,60,Y),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;na.push({id:s,name:e,avatar:l,score:t})}))}catch(a){_(b.ERROR,a.message)}oa.value=!1,ua[4]=0==ea.length}),oa)};return f((async()=>{try{const a=await j(1,100,Y),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await L(a),{songs:l}=e;l.forEach((a=>{w([],$,a)})),E(a,$),C.initLoveMusic($)}}catch(a){_(b.ERROR,a.message)}ia.value=!1}),ia),(s,e)=>{const l=a;return c(),n("div",D,[o(r(M,{songs:$,"song-id-mapper":u(aa),onCloseSelect:Q},null,8,["songs","song-id-mapper"]),[[i,K.value]]),o(r(B,{onGetActive:ma,active:"song",class:"search-tab"},{content:m((()=>[r(l,{label:"歌曲",name:"song"},{default:m((()=>[p("div",G,[p("div",V,[r(P,{songs:$},null,8,["songs"]),r(z,{icon:"",onClick:X,name:"全部收藏"}),r(z,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=a=>K.value=!K.value)})]),r(x,{songs:$,"song-id-mapper":u(aa),height:u(J)},null,8,["songs","song-id-mapper","height"])])])),_:1}),r(l,{label:"视频",name:"video"},{default:m((()=>[r(k,{"is-loading":oa.value},null,8,["is-loading"]),o(r(N,null,null,512),[[i,ua[0]]]),o(r(A,{mvs:sa},null,8,["mvs"]),[[i,!ua[0]]])])),_:1}),r(l,{label:"MV",name:"mv"},{default:m((()=>[r(k,{"is-loading":oa.value},null,8,["is-loading"]),o(r(N,null,null,512),[[i,ua[1]]]),o(r(A,{mvs:ea},null,8,["mvs"]),[[i,!ua[1]]])])),_:1}),r(l,{label:"专辑",name:"album"},{default:m((()=>[r(k,{"is-loading":oa.value},null,8,["is-loading"]),o(r(N,null,null,512),[[i,ua[2]]]),o(r(I,{albums:la},null,8,["albums"]),[[i,!ua[2]]])])),_:1}),r(l,{label:"歌单",name:"playList"},{default:m((()=>[r(k,{"is-loading":oa.value},null,8,["is-loading"]),o(r(N,null,null,512),[[i,ua[3]]]),o(r(T,{playlists:ta},null,8,["playlists"]),[[i,!ua[3]]])])),_:1}),r(l,{label:"歌手",name:"singer"},{default:m((()=>[r(k,{"is-loading":oa.value},null,8,["is-loading"]),o(r(N,null,null,512),[[i,ua[4]]]),o(p("div",q,[r(U,{"singer-list":na,"show-all-avatar":!1},null,8,["singer-list"])],512),[[i,!ua[4]]])])),_:1})])),_:1},512),[[i,!K.value]])])}}}),[["__scopeId","data-v-b62b439f"]]);export{F as default};
