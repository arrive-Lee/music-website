import{u as a}from"../element-plus/element-plus.372e8740.js";import{T as s,_ as e}from"../Tab/Tab.500b9b1b.js";import{G as l,d as t,Z as o,c as i,U as n,O as r,o as u,a as m,P as c,V as p,M as v,R as d,n as g,z as h}from"../@vue/@vue.7ad02ad1.js";import{b as y}from"../vue-router/vue-router.53ff932e.js";import{a as f,u as j,c as k,p as b,f as R,h as E,q as L,r as C,k as S,l as w,e as _,s as O,_ as P}from"../../assets/index-964692d5.js";import{P as I}from"../PlayButton/PlayButton.a2a16fce.js";import{D as M}from"../DecoratedButton/DecoratedButton.162503fc.js";import{M as A}from"../Mv/Mv.4e0814f8.js";import{A as T}from"../Albums/Albums.1e118198.js";import{P as U}from"../PlayList/PlayList.cfb4d7ae.js";import{L as z}from"../Loading/Loading.6acdd10c.js";import{S as N}from"../Singer/Singer.ef91fef3.js";import{N as x}from"../NoSearch/NoSearch.df7b5905.js";import{s as B}from"../pinia/pinia.07d51cb2.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";import"../lodash/lodash.57b1d944.js";import"../default-passive-events/default-passive-events.8ad95ed0.js";const D={class:"search-container scroll-container"},G={class:"song"},V={class:"top-operation"},q={class:"top-operation operation-select"},F={key:1,class:"singers"},H=P(l({__name:"SearchView",setup(l){const P=f(),{loveMusicId:H,loveSongs:W}=B(P),Z=j(),{isPlay:J,songList:K,songListId:Q,playProcess:X,playTime:Y,current:$}=B(Z),aa=t(!1);let sa=o([]);const ea=a=>{sa=o([]),sa.push(...a)},la=async()=>{sa.length>0?(J.value=!1,X.value=0,Y.value=0,await g(),sa.forEach((a=>{null==Q.value.get(a.id)&&K.value.unshift(a)})),$.value=Q.value.get(sa[0].id),J.value=!0,R(E.SUCCESS,"已添加到播放列表！")):R(E.INFO,"请添加歌曲！")},ta=()=>{sa.forEach((a=>{P.addMuiscDownload(a)}))},oa=()=>{ra.forEach((a=>{a.isLove=!0;null==H.value.get(a.id)&&W.value.push(a)})),_(O.LOCAL,"loveSongs",W.value)},ia=()=>{sa.forEach((a=>{a.isLove=!0;null==H.value.get(a.id)&&W.value.push(a)})),_(O.LOCAL,"loveSongs",W.value)},na=y().query.keyWord+"",ra=o([]),ua=o([]),ma=o([]),ca=o([]),pa=o([]),va=o([]),da=t(!1),ga=h("firstLoading"),ha=h("hideScroll"),ya=a=>{ha(),"mv"==a&&0==ma.length?k((async()=>{try{const a=await b(1004,60,na),{result:{mvs:s}}=a;s&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:o}=a;ma.push({id:s,name:e,image:l,artist:t,playCount:o})}))}catch(a){R(E.ERROR,a.message)}da.value=!1}),da):"album"==a&&0==ca.length?k((async()=>{try{const a=await b(10,60,na),{result:{albums:s}}=a;s&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:o}=a;ca.push({id:s,name:e,cover:l,publishTime:L(t),artistId:o.id})}))}catch(a){R(E.ERROR,a.message)}da.value=!1}),da):"playList"==a&&0==pa.length?k((async()=>{try{const a=await b(1e3,60,na),{result:{playlists:s}}=a;s&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;pa.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){R(E.ERROR,a.message)}da.value=!1}),da):"singer"==a&&0==va.length?k((async()=>{try{const a=await b(100,60,na),{result:{artists:s}}=a;s&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;va.push({id:s,name:e,avatar:l,score:t})}))}catch(a){R(E.ERROR,a.message)}da.value=!1}),da):"video"==a&&0==ua.length&&k((async()=>{try{const a=await b(1014,60,na),{result:{videos:s}}=a;s&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:o}=a;ua.push({id:s,name:e,image:l,artist:t[0].userName,playCount:o})}))}catch(a){R(E.ERROR,a.message)}da.value=!1}),da)};return k((async()=>{try{const a=await b(1,100,na),{result:{songs:s}}=a;if(s){const a=s.map((a=>a.id)).join(","),e=await C(a),{songs:l}=e;l.forEach((a=>{S([],ra,a)})),w(a,ra),P.initLoveMusic(ra)}}catch(a){R(E.ERROR,a.message)}ga.value=!1}),ga),(l,t)=>{const o=e,g=a;return u(),i("div",D,[n(s,{onGetActive:ya,active:"song",class:"search-tab"},{content:r((()=>[n(g,{label:"歌曲",name:"song"},{default:r((()=>[m("div",G,[c(m("div",V,[n(I,{songs:ra},null,8,["songs"]),n(M,{icon:"",onClick:oa,name:"全部收藏"}),n(M,{icon:"",name:"批量操作",onClick:t[0]||(t[0]=a=>aa.value=!aa.value)})],512),[[p,!aa.value]]),c(m("div",q,[n(M,{icon:"",name:"播放",class:"play",onClick:la}),n(M,{icon:"",name:"收藏",onClick:ia}),n(M,{icon:"󰌄",onClick:ta,name:"下载"}),n(M,{icon:"",name:"取消操作",onClick:t[1]||(t[1]=a=>aa.value=!aa.value)})],512),[[p,aa.value]]),n(o,{songs:ra,showSelect:aa.value,onGetSelectItems:ea,height:"440px"},null,8,["songs","showSelect"])])])),_:1}),n(g,{label:"视频",name:"video"},{default:r((()=>[da.value?(u(),v(z,{key:0,"is-loading":da.value},null,8,["is-loading"])):d("",!0),0==ua.length?(u(),v(x,{key:1})):(u(),v(A,{key:2,mvs:ua},null,8,["mvs"]))])),_:1}),n(g,{label:"MV",name:"mv"},{default:r((()=>[da.value?(u(),v(z,{key:0,"is-loading":da.value},null,8,["is-loading"])):d("",!0),0==ma.length?(u(),v(x,{key:1})):(u(),v(A,{key:2,mvs:ma},null,8,["mvs"]))])),_:1}),n(g,{label:"专辑",name:"album"},{default:r((()=>[da.value?(u(),v(z,{key:0,"is-loading":da.value},null,8,["is-loading"])):d("",!0),0==ca.length?(u(),v(x,{key:1})):(u(),v(T,{key:2,albums:ca},null,8,["albums"]))])),_:1}),n(g,{label:"歌单",name:"playList"},{default:r((()=>[da.value?(u(),v(z,{key:0,"is-loading":da.value},null,8,["is-loading"])):d("",!0),0==pa.length?(u(),v(x,{key:1})):(u(),v(U,{key:2,playlists:pa},null,8,["playlists"]))])),_:1}),n(g,{label:"歌手",name:"singer"},{default:r((()=>[0==va.length?(u(),v(x,{key:0})):(u(),i("div",F,[n(N,{"singer-list":va},null,8,["singer-list"])]))])),_:1})])),_:1})])}}}),[["__scopeId","data-v-1894713d"]]);export{H as default};
