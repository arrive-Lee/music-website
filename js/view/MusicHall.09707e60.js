import{u as a,w as e}from"../element-plus/element-plus.372e8740.js";import{G as l,ax as s,i as t,d as i,Z as n,c as u,U as o,O as r,u as c,o as v,P as m,F as p,a7 as d,M as h,V as g,z as f}from"../@vue/@vue.7ad02ad1.js";import{g as y,p as j,b,G as R,e as w,d as E,H as k,I as C,J as O,f as _,K as x,_ as I}from"../../assets/index-9d9b6d07.js";import{T as S}from"../Tab/Tab.8ebded53.js";import{P as T}from"../PlayList/PlayList.99960c4a.js";import{L as U}from"../Loading/Loading.deb2b6bd.js";import{t as L}from"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../pinia/pinia.07d51cb2.js";import"../axios/axios.d4208f68.js";import"../vue-router/vue-router.47595bf3.js";import"../nprogress/nprogress.8c6d26c7.js";const z={class:"music-hall-container"},F=["infinite-scroll-disabled"],P=["infinite-scroll-disabled"],G=["infinite-scroll-disabled"],N=I(l({__name:"MusicHall",setup(l){s((a=>({"360ecf05":c(I),ca95c526:c(N),d330f7b6:A.value,"645fa22a":c(M),e69adc70:B.value})));const I=y().get("fontColor"),N=y().get("shadow"),H=j(),M=t((()=>H.isFullScreen?"76.3vh":"73.3vh")),A=i("0px"),B=i("none"),J=()=>{B.value="none",A.value="0"};let K=0;const V=L((()=>{"block"!=B.value&&(B.value="block",A.value="6px"),K&&clearTimeout(K),K=setTimeout((()=>{"none"!=B.value&&J()}),3e3)}),600,{leading:!0,trailing:!1}),Z=f("firstLoading"),q=i(!1),D=n([]),Q=n([]),W=n([]),X=i(18),Y=i(0),$=i(!1),aa=async()=>{try{const a=await O(100,W[Y.value]),{playlists:e}=a;e.forEach((a=>{const{name:e,id:l,coverImgUrl:s,playCount:t}=a;D[Y.value].push({name:e,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(a){w(E.ERROR,a.message)}0==Y.value&&(Q[Y.value].push(...D[Y.value].slice(0,X.value)),Z.value=!1),q.value&&(q.value=!1)},ea=()=>{$.value=!0,X.value+=12,X.value<D[Y.value].length?setTimeout((()=>{Q[Y.value].push(...D[Y.value].slice(X.value-12,X.value)),$.value=!1}),100):(q.value=!0,Y.value<W.length?(X.value=0,Q[Y.value].push(...D[Y.value].slice(Q[Y.value].length)),Y.value++,aa(),$.value=!1):(q.value=!1,w(E.INFO,"已经到底部啦！")))},la=n([]),sa=n([]),ta=n([]),ia=i(18),na=i(0),ua=i(!1),oa=async()=>{try{const a=await _(100,ta[na.value]),{playlists:e}=a;e.forEach((a=>{const{name:e,id:l,coverImgUrl:s,playCount:t}=a;la[na.value].push({name:e,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(a){w(E.ERROR,a.message)}0==na.value&&(sa[na.value].push(...la[na.value].slice(0,ia.value)),Z.value=!1),q.value&&(q.value=!1)},ra=()=>{ua.value=!0,ia.value+=12,ia.value<la[Y.value].length?setTimeout((()=>{sa[na.value].push(...la[na.value].slice(ia.value-12,ia.value)),ua.value=!1}),100):(q.value=!0,na.value<ta.length?(ia.value=0,sa[na.value].push(...la[na.value].slice(sa[na.value].length)),na.value++,oa(),ua.value=!1):(q.value=!1,w(E.INFO,"已经到底部啦！")))},ca=n([]),va=n([]),ma=i(0),pa=i(!1),da=()=>{pa.value=!0,q.value=!0,ma.value++,ma.value<va.length?(ha(),pa.value=!1):(w(E.SUCCESS,"已经到达底部啦！"),q.value=!1)},ha=async()=>{try{const a=await x(va[ma.value].id),{data:{playlist:e}}=a;e.forEach((a=>{const{id:e,name:l,cover:s,playCount:t}=a;ca[ma.value].push({id:e,name:l,image:s,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){w(E.ERROR,a.message)}0==ma.value&&(Z.value=!1),q.value&&(q.value=!1)},ga=a=>{J(),"rec"==a&&0==la[0].length?(Z.value=!0,oa()):"style"==a&&0==ca[0].length&&(Z.value=!0,ha())};return b((async()=>{try{const a=await R(),{tags:e}=a;W.push(...e.map((a=>a.name))),W.forEach((a=>{D.push([]),Q.push([])}))}catch(a){w(E.ERROR,a.message)}try{const a=await k(),{sub:e}=a;ta.push(...e.map((a=>a.name))),ta.forEach((a=>{la.push([]),sa.push([])}))}catch(a){w(E.ERROR,a.message)}try{const a=await C(),{data:e}=a;e.forEach((a=>{const{tagId:e,tagName:l}=a;va.push({id:e,name:l}),ca.push([])}))}catch(a){w(E.ERROR,a.message)}aa()}),Z),(l,s)=>{const t=a,i=e;return v(),u("div",z,[o(S,{active:"top",onGetActive:ga},{content:r((()=>[o(t,{label:"精选歌单",name:"top"},{default:r((()=>[m((v(),u("div",{class:"container scroll-container",onScroll:s[0]||(s[0]=a=>c(V)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":$.value,style:{overflow:"auto"}},[(v(!0),u(p,null,d(Q,((a,e)=>m((v(),h(T,{key:W[e],title:W[e],playlists:a},null,8,["title","playlists"])),[[g,a.length>0]]))),128)),o(U,{"is-loading":q.value},null,8,["is-loading"])],40,F)),[[i,ea]])])),_:1}),o(t,{label:"网友推荐",name:"rec"},{default:r((()=>[m((v(),u("div",{class:"container scroll-container",onScroll:s[1]||(s[1]=a=>c(V)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":ua.value,style:{overflow:"auto"}},[(v(!0),u(p,null,d(sa,((a,e)=>m((v(),h(T,{key:ta[e],title:ta[e],playlists:a},null,8,["title","playlists"])),[[g,a.length>0]]))),128)),o(U,{"is-loading":q.value},null,8,["is-loading"])],40,P)),[[i,ra]])])),_:1}),o(t,{label:"浪漫曲风",name:"style"},{default:r((()=>[m((v(),u("div",{class:"container scroll-container",onScroll:s[2]||(s[2]=a=>c(V)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":pa.value,style:{overflow:"auto"}},[(v(!0),u(p,null,d(ca,((a,e)=>m((v(),h(T,{key:va[e].id,title:va[e].name,playlists:a},null,8,["title","playlists"])),[[g,a.length>0]]))),128)),o(U,{"is-loading":q.value},null,8,["is-loading"])],40,G)),[[i,da]])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-6fb40776"]]);export{N as default};
