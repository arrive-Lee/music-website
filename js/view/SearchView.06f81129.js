import{u as s}from"../element-plus/element-plus.ec47f34a.js";import{G as a,ax as e,i as t,d as l,Z as o,c as i,P as n,V as r,U as m,u,O as c,z as p,o as g,a as d}from"../@vue/@vue.7ad02ad1.js";import{b as v}from"../vue-router/vue-router.47595bf3.js";import{s as h}from"../pinia/pinia.07d51cb2.js";import{p as y,a as j,b as f,q as _,e as b,d as R,r as x,t as E,i as L,j as S,_ as w}from"../../assets/index-bb6340fe.js";import{_ as T}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.307fc5ec.js";import{T as O}from"../Tab/Tab.2a212439.js";import{O as C}from"../OnlineBatch/OnlineBatch.63f966a3.js";import{P as k}from"../PlayButton/PlayButton.0c5c0487.js";import{D as B}from"../DecoratedButton/DecoratedButton.1bb8ce4c.js";import{M}from"../Mv/Mv.7251b4da.js";import{A as P}from"../Albums/Albums.8ae82458.js";import{P as z}from"../PlayList/PlayList.23bbeeff.js";import{S as I}from"../Singer/Singer.9c7fb2fd.js";import{L as U}from"../Loading/Loading.be906d30.js";import{_ as A}from"../NoSearch/NoSearch.7dacdb67.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.c1293ab3.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.9249ff62.js";const D={class:"search-container scroll-container"},N={class:"song"},G={class:"header-operation"},V=w(a({__name:"SearchView",setup(a){e((s=>({"5afdd136":u(F)})));const w=y(),{isFullScreen:V}=h(w),q=t((()=>V.value?"580px":"440px")),F=p("fontGray"),H=j(),{loveMusicId:J,loveSongs:K}=h(H),W=l(!1),Z=s=>{W.value=s},Q=()=>{Y.forEach((s=>{s.isLove=!0;null==J.value.get(s.id)&&K.value.push(s)}))},X=v().query.keyWord+"",Y=o([]),$=t((()=>new Map(Y.map(((s,a)=>[s.id,a]))))),ss=o([]),as=o([]),es=o([]),ts=o([]),ls=o([]),os=l(!1),is=p("firstLoading"),ns=p("hideScroll"),rs=o([!1,!1,!1,!1,!1]),ms=s=>{ns(),"video"==s&&0==ss.length?f((async()=>{try{const s=await _(1014,60,X),{result:{videos:a}}=s;a&&a.length>0&&a.forEach((s=>{const{vid:a,title:e,coverUrl:t,creator:l,playTime:o}=s;ss.push({id:a,name:e,image:t,artist:l[0].userName,playCount:o})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{os.value=!1}),500),rs[0]=0==ss.length}),os):"mv"==s&&0==as.length?f((async()=>{try{const s=await _(1004,60,X),{result:{mvs:a}}=s;a&&0!=a.length&&a.forEach((s=>{const{id:a,name:e,cover:t,artistName:l,playCount:o}=s;as.push({id:a,name:e,image:t,artist:l,playCount:o})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{os.value=!1}),500),rs[1]=0==as.length}),os):"album"==s&&0==es.length?f((async()=>{try{const s=await _(10,60,X),{result:{albums:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,picUrl:t,publishTime:l,artist:o}=s;es.push({id:a,name:e,cover:t,publishTime:x(l),artistId:o.id})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{os.value=!1}),500),rs[2]=0==as.length}),os):"playList"==s&&0==ts.length?f((async()=>{try{const s=await _(1e3,60,X),{result:{playlists:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,coverImgUrl:t,playCount:l}=s;ts.push({id:a,name:e,image:t,playCount:l,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{os.value=!1}),500),rs[3]=0==as.length}),os):"singer"==s&&0==ls.length&&f((async()=>{try{const s=await _(100,60,X),{result:{artists:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,picUrl:t,accountId:l}=s;ls.push({id:a,name:e,avatar:t,score:l})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{os.value=!1}),500),rs[4]=0==as.length}),os)};return f((async()=>{try{const s=await _(1,100,X),{result:{songs:a}}=s;if(a&&a.length>0){const s=a.map((s=>s.id)).join(","),e=await E(s),{songs:t}=e;t.forEach((s=>{L([],Y,s)})),S(s,Y),H.initLoveMusic(Y)}}catch(s){b(R.ERROR,s.message)}is.value=!1}),is),(a,e)=>{const t=s;return g(),i("div",D,[n(m(C,{songs:Y,"song-id-mapper":u($),onCloseSelect:Z},null,8,["songs","song-id-mapper"]),[[r,W.value]]),n(m(O,{onGetActive:ms,active:"song",class:"search-tab"},{content:c((()=>[m(t,{label:"歌曲",name:"song"},{default:c((()=>[d("div",N,[d("div",G,[m(k,{songs:Y},null,8,["songs"]),m(B,{icon:"",onClick:Q,name:"全部收藏"}),m(B,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=s=>W.value=!W.value)})]),m(T,{songs:Y,"song-id-mapper":u($),height:u(q)},null,8,["songs","song-id-mapper","height"])])])),_:1}),m(t,{label:"视频",name:"video"},{default:c((()=>[m(U,{"is-loading":os.value},null,8,["is-loading"]),n(m(A,{text:"暂无搜索结果"},null,512),[[r,rs[0]]]),n(m(M,{mvs:ss},null,8,["mvs"]),[[r,!rs[0]]])])),_:1}),m(t,{label:"MV",name:"mv"},{default:c((()=>[m(U,{"is-loading":os.value},null,8,["is-loading"]),n(m(A,{text:"暂无搜索结果"},null,512),[[r,rs[1]]]),n(m(M,{mvs:as},null,8,["mvs"]),[[r,!rs[1]]])])),_:1}),m(t,{label:"专辑",name:"album"},{default:c((()=>[m(U,{"is-loading":os.value},null,8,["is-loading"]),n(m(A,{text:"暂无搜索结果"},null,512),[[r,rs[2]]]),n(m(P,{albums:es},null,8,["albums"]),[[r,!rs[2]]])])),_:1}),m(t,{label:"歌单",name:"playList"},{default:c((()=>[m(U,{"is-loading":os.value},null,8,["is-loading"]),n(m(A,{text:"暂无搜索结果"},null,512),[[r,rs[3]]]),n(m(z,{playlists:ts},null,8,["playlists"]),[[r,!rs[3]]])])),_:1}),m(t,{label:"歌手",name:"singer"},{default:c((()=>[m(U,{"is-loading":os.value},null,8,["is-loading"]),n(m(A,{text:"暂无搜索结果"},null,512),[[r,rs[4]]]),n(m(I,{"singer-list":ls},null,8,["singer-list"]),[[r,!rs[4]]])])),_:1})])),_:1},512),[[r,!W.value]])])}}}),[["__scopeId","data-v-e0b6981a"]]);export{V as default};
