import{u as s}from"../element-plus/element-plus.372e8740.js";import{G as a,ax as e,i as l,d as t,Z as o,c as n,P as i,V as r,U as m,u,O as c,z as p,o as g,a as d}from"../@vue/@vue.7ad02ad1.js";import{b as v}from"../vue-router/vue-router.47595bf3.js";import{s as h}from"../pinia/pinia.07d51cb2.js";import{p as y,a as j,b as f,q as _,e as b,d as R,r as E,t as w,i as L,j as S,_ as T}from"../../assets/index-211f8d91.js";import{_ as O}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.352ff53d.js";import{T as x}from"../Tab/Tab.4f93e7da.js";import{O as C}from"../OnlineBatch/OnlineBatch.bc4e75ab.js";import{P as B}from"../PlayButton/PlayButton.314a7018.js";import{D as M}from"../DecoratedButton/DecoratedButton.d4ec4efd.js";import{M as P}from"../Mv/Mv.eb306db3.js";import{A as k}from"../Albums/Albums.a98589b2.js";import{P as z}from"../PlayList/PlayList.3e7b14af.js";import{S as I}from"../Singer/Singer.b302d1de.js";import{L as U}from"../Loading/Loading.263d9cc7.js";import{N as A}from"../NoSearch/NoSearch.d336776b.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const N={class:"search-container scroll-container"},D={class:"song"},G={class:"header-operation"},V={class:"singers"},q=T(a({__name:"SearchView",setup(a){e((s=>({"3d1ec564":u(H)})));const T=y(),{isFullScreen:q}=h(T),F=l((()=>q.value?"580px":"440px")),H=p("fontGray"),J=j(),{loveMusicId:W,loveSongs:Z}=h(J),K=t(!1),Q=s=>{K.value=s},X=()=>{$.forEach((s=>{s.isLove=!0;null==W.value.get(s.id)&&Z.value.push(s)}))},Y=v().query.keyWord+"",$=o([]),ss=l((()=>new Map($.map(((s,a)=>[s.id,a]))))),as=o([]),es=o([]),ls=o([]),ts=o([]),os=o([]),ns=t(!1),is=p("firstLoading"),rs=p("hideScroll"),ms=o([!1,!1,!1,!1,!1]),us=s=>{rs(),"video"==s&&0==as.length?f((async()=>{try{const s=await _(1014,60,Y),{result:{videos:a}}=s;a&&a.length>0&&a.forEach((s=>{const{vid:a,title:e,coverUrl:l,creator:t,playTime:o}=s;as.push({id:a,name:e,image:l,artist:t[0].userName,playCount:o})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{ns.value=!1}),500),ms[0]=0==as.length}),ns):"mv"==s&&0==es.length?f((async()=>{try{const s=await _(1004,60,Y),{result:{mvs:a}}=s;a&&0!=a.length&&a.forEach((s=>{const{id:a,name:e,cover:l,artistName:t,playCount:o}=s;es.push({id:a,name:e,image:l,artist:t,playCount:o})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{ns.value=!1}),500),ms[1]=0==es.length}),ns):"album"==s&&0==ls.length?f((async()=>{try{const s=await _(10,60,Y),{result:{albums:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,picUrl:l,publishTime:t,artist:o}=s;ls.push({id:a,name:e,cover:l,publishTime:E(t),artistId:o.id})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{ns.value=!1}),500),ms[2]=0==es.length}),ns):"playList"==s&&0==ts.length?f((async()=>{try{const s=await _(1e3,60,Y),{result:{playlists:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,coverImgUrl:l,playCount:t}=s;ts.push({id:a,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{ns.value=!1}),500),ms[3]=0==es.length}),ns):"singer"==s&&0==os.length&&f((async()=>{try{const s=await _(100,60,Y),{result:{artists:a}}=s;a&&a.length>0&&a.forEach((s=>{const{id:a,name:e,picUrl:l,accountId:t}=s;os.push({id:a,name:e,avatar:l,score:t})}))}catch(s){b(R.ERROR,s.message)}setTimeout((()=>{ns.value=!1}),500),ms[4]=0==es.length}),ns)};return f((async()=>{try{const s=await _(1,100,Y),{result:{songs:a}}=s;if(a&&a.length>0){const s=a.map((s=>s.id)).join(","),e=await w(s),{songs:l}=e;l.forEach((s=>{L([],$,s)})),S(s,$),J.initLoveMusic($)}}catch(s){b(R.ERROR,s.message)}is.value=!1}),is),(a,e)=>{const l=s;return g(),n("div",N,[i(m(C,{songs:$,"song-id-mapper":u(ss),onCloseSelect:Q},null,8,["songs","song-id-mapper"]),[[r,K.value]]),i(m(x,{onGetActive:us,active:"song",class:"search-tab"},{content:c((()=>[m(l,{label:"歌曲",name:"song"},{default:c((()=>[d("div",D,[d("div",G,[m(B,{songs:$},null,8,["songs"]),m(M,{icon:"",onClick:X,name:"全部收藏"}),m(M,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=s=>K.value=!K.value)})]),m(O,{songs:$,"song-id-mapper":u(ss),height:u(F)},null,8,["songs","song-id-mapper","height"])])])),_:1}),m(l,{label:"视频",name:"video"},{default:c((()=>[m(U,{"is-loading":ns.value},null,8,["is-loading"]),i(m(A,null,null,512),[[r,ms[0]]]),i(m(P,{mvs:as},null,8,["mvs"]),[[r,!ms[0]]])])),_:1}),m(l,{label:"MV",name:"mv"},{default:c((()=>[m(U,{"is-loading":ns.value},null,8,["is-loading"]),i(m(A,null,null,512),[[r,ms[1]]]),i(m(P,{mvs:es},null,8,["mvs"]),[[r,!ms[1]]])])),_:1}),m(l,{label:"专辑",name:"album"},{default:c((()=>[m(U,{"is-loading":ns.value},null,8,["is-loading"]),i(m(A,null,null,512),[[r,ms[2]]]),i(m(k,{albums:ls},null,8,["albums"]),[[r,!ms[2]]])])),_:1}),m(l,{label:"歌单",name:"playList"},{default:c((()=>[m(U,{"is-loading":ns.value},null,8,["is-loading"]),i(m(A,null,null,512),[[r,ms[3]]]),i(m(z,{playlists:ts},null,8,["playlists"]),[[r,!ms[3]]])])),_:1}),m(l,{label:"歌手",name:"singer"},{default:c((()=>[m(U,{"is-loading":ns.value},null,8,["is-loading"]),i(m(A,null,null,512),[[r,ms[4]]]),i(d("div",V,[m(I,{"singer-list":os,"show-all-avatar":!1},null,8,["singer-list"])],512),[[r,!ms[4]]])])),_:1})])),_:1},512),[[r,!K.value]])])}}}),[["__scopeId","data-v-7c9d47df"]]);export{q as default};
