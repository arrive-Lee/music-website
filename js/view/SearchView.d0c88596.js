import{u as a}from"../element-plus/element-plus.372e8740.js";import{G as s,ax as e,i as l,d as t,Z as n,c as i,P as o,V as r,U as m,u,O as c,z as p,o as g,a as d}from"../@vue/@vue.7ad02ad1.js";import{b as v}from"../vue-router/vue-router.47595bf3.js";import{s as h}from"../pinia/pinia.07d51cb2.js";import{p as y,a as f,b as j,q as _,e as b,d as R,r as E,t as w,i as L,j as S,_ as x}from"../../assets/index-6b4c8495.js";import{_ as O}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.06763e13.js";import{T as C}from"../Tab/Tab.91d95a69.js";import{O as B}from"../OnlineBatch/OnlineBatch.9aefdf34.js";import{P as M}from"../PlayButton/PlayButton.8b55a8c2.js";import{D as P}from"../DecoratedButton/DecoratedButton.28e5ed3e.js";import{M as z}from"../Mv/Mv.815d94ad.js";import{A as I}from"../Albums/Albums.9289865e.js";import{P as T}from"../PlayList/PlayList.95a8dcd9.js";import{S as U}from"../Singer/Singer.b77efdaf.js";import{L as k}from"../Loading/Loading.348d29cc.js";import{N as A}from"../NoSearch/NoSearch.7c1a4185.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const N={class:"search-container scroll-container"},D={class:"song"},G={class:"header-operation"},V={class:"singers"},q=x(s({__name:"SearchView",setup(s){e((a=>({"1da9f440":u(H)})));const x=y(),{isFullScreen:q}=h(x),F=l((()=>q.value?"580px":"440px")),H=p("fontGray"),W=f(),{loveMusicId:Z,loveSongs:J}=h(W),K=t(!1),Q=a=>{K.value=a},X=()=>{$.forEach((a=>{a.isLove=!0;null==Z.value.get(a.id)&&J.value.push(a)}))},Y=v().query.keyWord+"",$=n([]),aa=l((()=>new Map($.map(((a,s)=>[a.id,s]))))),sa=n([]),ea=n([]),la=n([]),ta=n([]),na=n([]),ia=t(!1),oa=p("firstLoading"),ra=p("hideScroll"),ma=n([!1,!1,!1,!1,!1]),ua=a=>{ra(),"video"==a&&0==sa.length?j((async()=>{try{const a=await _(1014,60,Y),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:n}=a;sa.push({id:s,name:e,image:l,artist:t[0].userName,playCount:n})}))}catch(a){b(R.ERROR,a.message)}ia.value=!1,ma[0]=0==sa.length}),ia):"mv"==a&&0==ea.length?j((async()=>{try{const a=await _(1004,60,Y),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:n}=a;ea.push({id:s,name:e,image:l,artist:t,playCount:n})}))}catch(a){b(R.ERROR,a.message)}ia.value=!1,ma[1]=0==ea.length}),ia):"album"==a&&0==la.length?j((async()=>{try{const a=await _(10,60,Y),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:n}=a;la.push({id:s,name:e,cover:l,publishTime:E(t),artistId:n.id})}))}catch(a){b(R.ERROR,a.message)}ia.value=!1,ma[2]=0==ea.length}),ia):"playList"==a&&0==ta.length?j((async()=>{try{const a=await _(1e3,60,Y),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;ta.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){b(R.ERROR,a.message)}ia.value=!1,ma[3]=0==ea.length}),ia):"singer"==a&&0==na.length&&j((async()=>{try{const a=await _(100,60,Y),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;na.push({id:s,name:e,avatar:l,score:t})}))}catch(a){b(R.ERROR,a.message)}ia.value=!1,ma[4]=0==ea.length}),ia)};return j((async()=>{try{const a=await _(1,100,Y),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await w(a),{songs:l}=e;l.forEach((a=>{L([],$,a)})),S(a,$),W.initLoveMusic($)}}catch(a){b(R.ERROR,a.message)}oa.value=!1}),oa),(s,e)=>{const l=a;return g(),i("div",N,[o(m(B,{songs:$,"song-id-mapper":u(aa),onCloseSelect:Q},null,8,["songs","song-id-mapper"]),[[r,K.value]]),o(m(C,{onGetActive:ua,active:"song",class:"search-tab"},{content:c((()=>[m(l,{label:"歌曲",name:"song"},{default:c((()=>[d("div",D,[d("div",G,[m(M,{songs:$},null,8,["songs"]),m(P,{icon:"",onClick:X,name:"全部收藏"}),m(P,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=a=>K.value=!K.value)})]),m(O,{songs:$,"song-id-mapper":u(aa),height:u(F)},null,8,["songs","song-id-mapper","height"])])])),_:1}),m(l,{label:"视频",name:"video"},{default:c((()=>[m(k,{"is-loading":ia.value},null,8,["is-loading"]),o(m(A,null,null,512),[[r,ma[0]]]),o(m(z,{mvs:sa},null,8,["mvs"]),[[r,!ma[0]]])])),_:1}),m(l,{label:"MV",name:"mv"},{default:c((()=>[m(k,{"is-loading":ia.value},null,8,["is-loading"]),o(m(A,null,null,512),[[r,ma[1]]]),o(m(z,{mvs:ea},null,8,["mvs"]),[[r,!ma[1]]])])),_:1}),m(l,{label:"专辑",name:"album"},{default:c((()=>[m(k,{"is-loading":ia.value},null,8,["is-loading"]),o(m(A,null,null,512),[[r,ma[2]]]),o(m(I,{albums:la},null,8,["albums"]),[[r,!ma[2]]])])),_:1}),m(l,{label:"歌单",name:"playList"},{default:c((()=>[m(k,{"is-loading":ia.value},null,8,["is-loading"]),o(m(A,null,null,512),[[r,ma[3]]]),o(m(T,{playlists:ta},null,8,["playlists"]),[[r,!ma[3]]])])),_:1}),m(l,{label:"歌手",name:"singer"},{default:c((()=>[m(k,{"is-loading":ia.value},null,8,["is-loading"]),o(m(A,null,null,512),[[r,ma[4]]]),o(d("div",V,[m(U,{"singer-list":na,"show-all-avatar":!1},null,8,["singer-list"])],512),[[r,!ma[4]]])])),_:1})])),_:1},512),[[r,!K.value]])])}}}),[["__scopeId","data-v-bc64e2f2"]]);export{q as default};
