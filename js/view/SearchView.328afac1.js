import{u as a}from"../element-plus/element-plus.372e8740.js";import{G as s,d as e,Z as l,i as t,c as n,P as o,V as i,U as r,u as m,O as u,o as c,a as p,z as g}from"../@vue/@vue.7ad02ad1.js";import{b as d}from"../vue-router/vue-router.47595bf3.js";import{s as v}from"../pinia/pinia.07d51cb2.js";import{a as h,b as y,p as f,e as j,d as _,q as b,r as R,i as L,j as E,t as w,v as S,_ as O}from"../../assets/index-18827e65.js";import{_ as C}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.578a2fa1.js";import{T as x}from"../Tab/Tab.ff177c71.js";import{O as B}from"../OnlineBatch/OnlineBatch.f2be709d.js";import{P as M}from"../PlayButton/PlayButton.59e396cd.js";import{D as P}from"../DecoratedButton/DecoratedButton.06e12d65.js";import{M as z}from"../Mv/Mv.9944bf12.js";import{A}from"../Albums/Albums.356bdea9.js";import{P as I}from"../PlayList/PlayList.c11a2e16.js";import{S as T}from"../Singer/Singer.c4230200.js";import{L as U}from"../Loading/Loading.df807210.js";import{N as k}from"../NoSearch/NoSearch.378da31a.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const N={class:"search-container scroll-container"},D={class:"song"},G={class:"header-operation"},V={class:"singers"},q=O(s({__name:"SearchView",setup(s){const O=h(),{loveMusicId:q,loveSongs:H}=v(O),J=e(!1),W=a=>{J.value=a},Z=()=>{K.forEach((a=>{a.isLove=!0;null==q.value.get(a.id)&&H.value.push(a)})),w(S.LOCAL,"loveSongs",H.value)},F=d().query.keyWord+"",K=l([]),Q=t((()=>new Map(K.map(((a,s)=>[a.id,s]))))),X=l([]),Y=l([]),$=l([]),aa=l([]),sa=l([]),ea=e(!1),la=g("firstLoading"),ta=g("hideScroll"),na=l([!1,!1,!1,!1,!1]),oa=a=>{ta(),"video"==a&&0==X.length?y((async()=>{try{const a=await f(1014,60,F),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:n}=a;X.push({id:s,name:e,image:l,artist:t[0].userName,playCount:n})}))}catch(a){j(_.ERROR,a.message)}ea.value=!1,na[0]=0==X.length}),ea):"mv"==a&&0==Y.length?y((async()=>{try{const a=await f(1004,60,F),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:n}=a;Y.push({id:s,name:e,image:l,artist:t,playCount:n})}))}catch(a){j(_.ERROR,a.message)}ea.value=!1,na[1]=0==Y.length}),ea):"album"==a&&0==$.length?y((async()=>{try{const a=await f(10,60,F),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:n}=a;$.push({id:s,name:e,cover:l,publishTime:b(t),artistId:n.id})}))}catch(a){j(_.ERROR,a.message)}ea.value=!1,na[2]=0==Y.length}),ea):"playList"==a&&0==aa.length?y((async()=>{try{const a=await f(1e3,60,F),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;aa.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){j(_.ERROR,a.message)}ea.value=!1,na[3]=0==Y.length}),ea):"singer"==a&&0==sa.length&&y((async()=>{try{const a=await f(100,60,F),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;sa.push({id:s,name:e,avatar:l,score:t})}))}catch(a){j(_.ERROR,a.message)}ea.value=!1,na[4]=0==Y.length}),ea)};return y((async()=>{try{const a=await f(1,100,F),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await R(a),{songs:l}=e;l.forEach((a=>{L([],K,a)})),E(a,K),O.initLoveMusic(K)}}catch(a){j(_.ERROR,a.message)}la.value=!1}),la),(s,e)=>{const l=a;return c(),n("div",N,[o(r(B,{songs:K,"song-id-mapper":m(Q),onCloseSelect:W},null,8,["songs","song-id-mapper"]),[[i,J.value]]),o(r(x,{onGetActive:oa,active:"song",class:"search-tab"},{content:u((()=>[r(l,{label:"歌曲",name:"song"},{default:u((()=>[p("div",D,[p("div",G,[r(M,{songs:K},null,8,["songs"]),r(P,{icon:"",onClick:Z,name:"全部收藏"}),r(P,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=a=>J.value=!J.value)})]),r(C,{songs:K,"song-id-mapper":m(Q),height:"440px"},null,8,["songs","song-id-mapper"])])])),_:1}),r(l,{label:"视频",name:"video"},{default:u((()=>[r(U,{"is-loading":ea.value},null,8,["is-loading"]),o(r(k,null,null,512),[[i,na[0]]]),o(r(z,{mvs:X},null,8,["mvs"]),[[i,!na[0]]])])),_:1}),r(l,{label:"MV",name:"mv"},{default:u((()=>[r(U,{"is-loading":ea.value},null,8,["is-loading"]),o(r(k,null,null,512),[[i,na[1]]]),o(r(z,{mvs:Y},null,8,["mvs"]),[[i,!na[1]]])])),_:1}),r(l,{label:"专辑",name:"album"},{default:u((()=>[r(U,{"is-loading":ea.value},null,8,["is-loading"]),o(r(k,null,null,512),[[i,na[2]]]),o(r(A,{albums:$},null,8,["albums"]),[[i,!na[2]]])])),_:1}),r(l,{label:"歌单",name:"playList"},{default:u((()=>[r(U,{"is-loading":ea.value},null,8,["is-loading"]),o(r(k,null,null,512),[[i,na[3]]]),o(r(I,{playlists:aa},null,8,["playlists"]),[[i,!na[3]]])])),_:1}),r(l,{label:"歌手",name:"singer"},{default:u((()=>[r(U,{"is-loading":ea.value},null,8,["is-loading"]),o(r(k,null,null,512),[[i,na[4]]]),o(p("div",V,[r(T,{"singer-list":sa,"show-all-avatar":!1},null,8,["singer-list"])],512),[[i,!na[4]]])])),_:1})])),_:1},512),[[i,!J.value]])])}}}),[["__scopeId","data-v-0de2da65"]]);export{q as default};
