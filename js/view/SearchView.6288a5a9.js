import{u as a}from"../element-plus/element-plus.f7914039.js";import{G as s,ax as e,i as l,d as t,Z as i,c as n,P as o,V as r,U as m,u,a as c,T as p,a2 as g,O as d,z as v,o as h}from"../@vue/@vue.7ad02ad1.js";import{b as f,u as y}from"../vue-router/vue-router.47595bf3.js";import{s as j}from"../pinia/pinia.07d51cb2.js";import{t as b,g as R,a as S,b as E,v as _,e as w,d as C,w as L,x as z,i as k,j as x,_ as T}from"../../assets/index-be634f60.js";import{P as O,_ as M}from"../PlayButton/PlayButton.fa45b851.js";import{T as U}from"../Tab/Tab.7203c28a.js";import{O as B}from"../OnlineBatch/OnlineBatch.332b5ce3.js";import{D as I}from"../DecoratedButton/DecoratedButton.aaebffcf.js";import{M as P}from"../Mv/Mv.81655aee.js";import{A}from"../Albums/Albums.e1a27c46.js";import{P as D}from"../PlayList/PlayList.29b1d502.js";import{S as N}from"../Singer/Singer.3a4995c7.js";import{L as G}from"../Loading/Loading.3eb9fe31.js";import{_ as V}from"../NoSearch/NoSearch.970b3d87.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.c1293ab3.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.9249ff62.js";const q={class:"search-container scroll-container"},F=["src"],H={class:"right-singer"},J={class:"singer-name"},K={class:"singer-info"},W={class:"song"},Z={class:"header-operation"},Q=T(s({__name:"SearchView",setup(s){e((a=>({"7be3f890":u(X),"006186d6":u($),ebfdcd66:u(Y),f7776bc2:u(aa),"2413d855":u(sa)})));const T=b(),{bgMode:Q}=j(T),X=v("fontGray"),Y=R().get("shadow"),$=R().get("fontColor"),aa=l((()=>"skin"==Q.value?"rgba(220, 220, 220, 0.1)":"#ffffff"==(null==$?void 0:$.value)?"rgba(30, 30, 30, 0.2)":"rgba(220, 220, 220, 0.25)")),sa=l((()=>"skin"==Q.value?"rgba(230, 230, 230, 0.25)":"#ffffff"==(null==$?void 0:$.value)?"rgba(30, 30, 30, 1)":"rgba(220, 220, 220, 0.8)")),ea=y(),la=S(),{loveMusicId:ta,loveSongs:ia}=j(la),na=t(!1),oa=a=>{Ra(),na.value=a},ra=()=>{ua.forEach((a=>{a.isLove=!0;null==ta.value.get(a.id)&&ia.value.push(a)}))},ma=f().query.keyWord+"",ua=i([]),ca=l((()=>new Map(ua.map(((a,s)=>[a.id,s]))))),pa=i([]),ga=i([]),da=i([]),va=i([]),ha=i([]),fa=i([]),ya=l((()=>fa.length>0?fa[0]:{name:"",avatar:"",id:"",score:"",albumSize:"",mvSize:""})),ja=t(!1),ba=v("firstLoading"),Ra=v("hideScroll"),Sa=i([!1,!1,!1,!1,!1,!1]),Ea=a=>{Ra(),"video"==a&&0==pa.length?E((async()=>{try{const a=await _(1014,60,ma),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:i}=a;pa.push({id:s,name:e,image:l,artist:t[0].userName,playCount:i})}))}catch(a){w(C.ERROR,a.message)}setTimeout((()=>{ja.value=!1}),500),Sa[0]=0==pa.length}),ja):"mv"==a&&0==ga.length?E((async()=>{try{const a=await _(1004,60,ma),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:i}=a;ga.push({id:s,name:e,image:l,artist:t,playCount:i})}))}catch(a){w(C.ERROR,a.message)}setTimeout((()=>{ja.value=!1}),500),Sa[1]=0==ga.length}),ja):"album"==a&&0==da.length?E((async()=>{try{const a=await _(10,60,ma),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:i}=a;da.push({id:s,name:e,cover:l,publishTime:L(t),artistId:i.id})}))}catch(a){w(C.ERROR,a.message)}setTimeout((()=>{ja.value=!1}),500),Sa[2]=0==da.length}),ja):"playList"==a&&0==va.length?E((async()=>{try{const a=await _(1e3,60,ma),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;va.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){w(C.ERROR,a.message)}setTimeout((()=>{ja.value=!1}),500),Sa[3]=0==va.length}),ja):"radio"==a&&E((async()=>{try{const a=await _(1009,60,ma),{result:{djRadios:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,playCount:t}=a;ha.push({name:e,id:s,image:l,playCount:t,creator:{nickname:"",avatarUrl:""},tag:[],description:""})}))}catch(a){w(C.ERROR,a.message)}setTimeout((()=>{ja.value=!1}),500),Sa[4]=0==ha.length}),ja)};return E((async()=>{try{const a=await _(1,100,ma),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await z(a),{songs:l}=e;l.forEach((a=>{k([],ua,a)})),x(a,ua),la.initLoveMusic(ua)}}catch(a){w(C.ERROR,a.message)}try{const a=await _(100,60,ma),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t,albumSize:i,mvSize:n}=a;fa.push({id:s,name:e,avatar:l,score:t,albumSize:i,mvSize:n})})),Sa[5]=0==fa.length}catch(a){w(C.ERROR,a.message)}ba.value=!1}),ba),(s,e)=>{const l=a;return h(),n("div",q,[o(m(B,{songs:ua,"song-id-mapper":u(ca),onCloseSelect:oa},null,8,["songs","song-id-mapper"]),[[r,na.value]]),o(c("div",{class:"result-singer",onClick:e[1]||(e[1]=a=>u(ea).push({name:"artist",query:{id:u(ya).id,score:u(ya).score}}))},[c("img",{src:u(ya).avatar,class:"left-singer"},null,8,F),c("div",H,[c("h4",J,"歌手："+p(u(ya).name),1),c("p",K,[c("span",null,"专辑："+p(u(ya).albumSize),1),c("span",null,"视频："+p(u(ya).mvSize),1)])]),m(I,{name:u(ya).isLove?"取消关注":"关注歌手",icon:u(ya).isLove?"":"","icon-style":u(ya).isLove?"color:#ff6a6a;":"",onClick:e[0]||(e[0]=g((a=>u(la).addLove(u(ya),u(la).loveSinger,u(la).loveSingerId)),["stop"]))},null,8,["name","icon","icon-style"])],512),[[r,u(ya).name]]),o(m(U,{onGetActive:Ea,active:"song",class:"search-tab"},{content:d((()=>[m(l,{label:"歌曲",name:"song"},{default:d((()=>[c("div",W,[c("div",Z,[m(O,{songs:ua},null,8,["songs"]),m(I,{icon:"",onClick:ra,name:"全部收藏"}),m(I,{icon:"",name:"批量操作",onClick:e[2]||(e[2]=a=>na.value=!na.value)})]),m(M,{songs:ua,"song-id-mapper":u(ca)},null,8,["songs","song-id-mapper"])])])),_:1}),m(l,{label:"视频",name:"video"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[0]]]),o(m(P,{mvs:pa},null,8,["mvs"]),[[r,!Sa[0]]])])),_:1}),m(l,{label:"MV",name:"mv"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[1]]]),o(m(P,{mvs:ga},null,8,["mvs"]),[[r,!Sa[1]]])])),_:1}),m(l,{label:"专辑",name:"album"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[2]]]),o(m(A,{albums:da},null,8,["albums"]),[[r,!Sa[2]]])])),_:1}),m(l,{label:"歌单",name:"playList"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[3]]]),o(m(D,{playlists:va},null,8,["playlists"]),[[r,!Sa[3]]])])),_:1}),m(l,{label:"电台",name:"radio"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[4]]]),o(m(D,{playlists:ha,type:"radio"},null,8,["playlists"]),[[r,!Sa[4]]])])),_:1}),m(l,{label:"歌手",name:"singer"},{default:d((()=>[m(G,{"is-loading":ja.value},null,8,["is-loading"]),o(m(V,{text:"暂无搜索结果"},null,512),[[r,Sa[5]]]),o(m(N,{"singer-list":fa},null,8,["singer-list"]),[[r,!Sa[5]]])])),_:1})])),_:1},512),[[r,!na.value]])])}}}),[["__scopeId","data-v-7111069a"]]);export{Q as default};
