import{u as a,w as e}from"../element-plus/element-plus.372e8740.js";import{G as l,ax as s,d as t,Z as i,c as n,U as o,O as u,u as r,o as c,P as v,F as m,a7 as p,M as d,V as h,z as g}from"../@vue/@vue.7ad02ad1.js";import{g as f,b as y,E as j,e as R,d as b,F as E,G as w,H as k,f as C,I as O,_}from"../../assets/index-74abaf53.js";import{T as x}from"../Tab/Tab.198fbee0.js";import{P as I}from"../PlayList/PlayList.2b1b7f7c.js";import{L as T}from"../Loading/Loading.8f5aaf42.js";import{t as U}from"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../pinia/pinia.07d51cb2.js";import"../axios/axios.d4208f68.js";import"../vue-router/vue-router.47595bf3.js";import"../nprogress/nprogress.8c6d26c7.js";const L={class:"music-hall-container"},S=["infinite-scroll-disabled"],z=["infinite-scroll-disabled"],F=["infinite-scroll-disabled"],P=_(l({__name:"MusicHall",setup(l){s((a=>({"3a24f360":r(_),"80fd9190":r(P),a701910c:G.value,"0169b15d":N.value})));const _=f().get("fontColor"),P=f().get("shadow"),G=t("0px"),N=t("none"),H=()=>{N.value="none",G.value="0"};let M=0;const A=U((()=>{"block"!=N.value&&(N.value="block",G.value="6px"),M&&clearTimeout(M),M=setTimeout((()=>{"none"!=N.value&&H()}),3e3)}),600,{leading:!0,trailing:!1}),B=g("firstLoading"),J=t(!1),V=i([]),Z=i([]),q=i([]),D=t(18),K=t(0),Q=t(!1),W=async()=>{try{const a=await k(100,q[K.value]),{playlists:e}=a;e.forEach((a=>{const{name:e,id:l,coverImgUrl:s,playCount:t}=a;V[K.value].push({name:e,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(a){R(b.ERROR,a.message)}0==K.value&&(Z[K.value].push(...V[K.value].slice(0,D.value)),B.value=!1),J.value&&(J.value=!1)},X=()=>{Q.value=!0,D.value+=12,D.value<V[K.value].length?setTimeout((()=>{Z[K.value].push(...V[K.value].slice(D.value-12,D.value)),Q.value=!1}),100):(J.value=!0,K.value<q.length?(D.value=0,Z[K.value].push(...V[K.value].slice(Z[K.value].length)),K.value++,W(),Q.value=!1):(J.value=!1,R(b.INFO,"已经到底部啦！")))},Y=i([]),$=i([]),aa=i([]),ea=t(18),la=t(0),sa=t(!1),ta=async()=>{try{const a=await C(100,aa[la.value]),{playlists:e}=a;e.forEach((a=>{const{name:e,id:l,coverImgUrl:s,playCount:t}=a;Y[la.value].push({name:e,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(a){R(b.ERROR,a.message)}0==la.value&&($[la.value].push(...Y[la.value].slice(0,ea.value)),B.value=!1),J.value&&(J.value=!1)},ia=()=>{sa.value=!0,ea.value+=12,ea.value<Y[K.value].length?setTimeout((()=>{$[la.value].push(...Y[la.value].slice(ea.value-12,ea.value)),sa.value=!1}),100):(J.value=!0,la.value<aa.length?(ea.value=0,$[la.value].push(...Y[la.value].slice($[la.value].length)),la.value++,ta(),sa.value=!1):(J.value=!1,R(b.INFO,"已经到底部啦！")))},na=i([]),oa=i([]),ua=t(0),ra=t(!1),ca=()=>{ra.value=!0,J.value=!0,ua.value++,ua.value<oa.length?(va(),ra.value=!1):(R(b.SUCCESS,"已经到达底部啦！"),J.value=!1)},va=async()=>{try{const a=await O(oa[ua.value].id),{data:{playlist:e}}=a;e.forEach((a=>{const{id:e,name:l,cover:s,playCount:t}=a;na[ua.value].push({id:e,name:l,image:s,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){R(b.ERROR,a.message)}0==ua.value&&(B.value=!1),J.value&&(J.value=!1)},ma=a=>{H(),"rec"==a&&0==Y[0].length?(B.value=!0,ta()):"style"==a&&0==na[0].length&&(B.value=!0,va())};return y((async()=>{try{const a=await j(),{tags:e}=a;q.push(...e.map((a=>a.name))),q.forEach((a=>{V.push([]),Z.push([])}))}catch(a){R(b.ERROR,a.message)}try{const a=await E(),{sub:e}=a;aa.push(...e.map((a=>a.name))),aa.forEach((a=>{Y.push([]),$.push([])}))}catch(a){R(b.ERROR,a.message)}try{const a=await w(),{data:e}=a;e.forEach((a=>{const{tagId:e,tagName:l}=a;oa.push({id:e,name:l}),na.push([])}))}catch(a){R(b.ERROR,a.message)}W()}),B),(l,s)=>{const t=a,i=e;return c(),n("div",L,[o(x,{active:"top",onGetActive:ma},{content:u((()=>[o(t,{label:"精选歌单",name:"top"},{default:u((()=>[v((c(),n("div",{class:"container scroll-container",onScroll:s[0]||(s[0]=a=>r(A)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":Q.value,style:{overflow:"auto"}},[(c(!0),n(m,null,p(Z,((a,e)=>v((c(),d(I,{key:q[e],title:q[e],playlists:a},null,8,["title","playlists"])),[[h,a.length>0]]))),128)),o(T,{"is-loading":J.value},null,8,["is-loading"])],40,S)),[[i,X]])])),_:1}),o(t,{label:"网友推荐",name:"rec"},{default:u((()=>[v((c(),n("div",{class:"container scroll-container",onScroll:s[1]||(s[1]=a=>r(A)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":sa.value,style:{overflow:"auto"}},[(c(!0),n(m,null,p($,((a,e)=>v((c(),d(I,{key:aa[e],title:aa[e],playlists:a},null,8,["title","playlists"])),[[h,a.length>0]]))),128)),o(T,{"is-loading":J.value},null,8,["is-loading"])],40,z)),[[i,ia]])])),_:1}),o(t,{label:"浪漫曲风",name:"style"},{default:u((()=>[v((c(),n("div",{class:"container scroll-container",onScroll:s[2]||(s[2]=a=>r(A)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":ra.value,style:{overflow:"auto"}},[(c(!0),n(m,null,p(na,((a,e)=>v((c(),d(I,{key:oa[e].id,title:oa[e].name,playlists:a},null,8,["title","playlists"])),[[h,a.length>0]]))),128)),o(T,{"is-loading":J.value},null,8,["is-loading"])],40,F)),[[i,ca]])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-a5a73d68"]]);export{P as default};
