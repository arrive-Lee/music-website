import{u as a,g as e,w as s}from"../element-plus/element-plus.372e8740.js";import{G as l,ax as t,d as i,Z as o,P as n,c as r,U as u,O as c,u as p,o as m,F as v,a7 as d,a as h,T as g,a2 as y,z as f}from"../@vue/@vue.7ad02ad1.js";import{u as j}from"../vue-router/vue-router.53ff932e.js";import{g as R,b as w,A as b,e as E,d as _,B as k,C as O,_ as U}from"../../assets/index-436cfb30.js";import{T as x}from"../Tab/Tab.3823af0d.js";import{P as z}from"../PlayList/PlayList.7dbb9b44.js";import{L as C}from"../Loading/Loading.a215bf41.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../pinia/pinia.07d51cb2.js";import"../nprogress/nprogress.8c6d26c7.js";const I=["infinite-scroll-disabled"],L={class:"title"},T={class:"content"},P=["onMousedown"],F=U(l({__name:"MusicHall",setup(l){t((a=>({"165e634a":p(F),"1f1b81c3":p(M)})));const U=j(),F=R().get("fontColor"),M=R().get("shadow"),N=i(!1),A=i(!1),G=f("firstLoading"),H=f("hideScroll"),q=i("top"),B=i(48),D=i(24),S=o([]),Z=o([]),J=i(1),K=o([]),Q=o([]),V=()=>{"top"==q.value?W():"hot"==q.value&&Y()},W=()=>{A.value=!0,N.value=!0,setTimeout((()=>{D.value+=12,D.value<=S.length?(Z.push(...S.slice(Z.length,D.value)),A.value=!1,N.value=!1):B.value==S.length?(B.value*=2,X()):(Z.push(...S.slice(Z.length)),A.value=!1,E(_.INFO,"已经到底底部！"))}),1e3)},X=()=>{w((async()=>{try{const a=await k(B.value),{playlists:e}=a;e.slice(S.length).forEach((a=>{const{name:e,id:s,coverImgUrl:l,playCount:t,description:i,tags:o,creator:n}=a;S.push({name:e,id:s,playCount:t,description:i,image:l,tag:o,creator:{avatarUrl:n.avatarUrl,nickname:n.nickname}})})),Z.push(...S.slice(Z.length,D.value))}catch(a){E(_.ERROR,a.message)}A.value=!1,N.value=!1}),A)},Y=()=>{J.value<K.length?(A.value=!0,N.value=!0,setTimeout((async()=>{$(K[J.value].id),A.value=!1,N.value=!1,J.value++}),1e3)):(N.value=!0,E(_.INFO,"已达到底部"))},$=a=>{w((async()=>{try{const e=await O(a),{data:{playlist:s}}=e,l=o([]);s.forEach((a=>{const{id:e,name:s,cover:t}=a;l.push({id:e,name:s,cover:t})})),Q.push(l)}catch(e){E(_.ERROR,e.message)}}))},aa=a=>{H(),q.value=a,"hot"==a&&0==K.length&&w((async()=>{try{const a=await b(),{data:e}=a;e.forEach(((a,e)=>{const{tagId:s,tagName:l}=a;K.push({id:s,name:l}),e<J.value&&$(s)}))}catch(a){E(_.ERROR,a.message)}G.value=!1}),G)};return w((async()=>{try{const a=await k(B.value),{playlists:e}=a;e.forEach((a=>{const{name:e,id:s,coverImgUrl:l,playCount:t,description:i,tags:o,creator:n}=a;S.push({name:e,id:s,playCount:t,description:i,image:l,tag:o,creator:{avatarUrl:n.avatarUrl,nickname:n.nickname}})})),Z.push(...S.slice(0,D.value)),G.value=!1}catch(a){E(_.ERROR,a.message)}}),G),(l,t)=>{const i=a,o=e,p=s;return n((m(),r("div",{class:"music-hall-container scroll-container","infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":N.value,style:{overflow:"auto"}},[u(x,{active:"top",onGetActive:aa},{content:c((()=>[u(i,{label:"精选歌单",name:"top"},{default:c((()=>[u(z,{playlists:Z},null,8,["playlists"]),u(C,{"is-loading":A.value},null,8,["is-loading"])])),_:1}),u(i,{label:"精选曲风",name:"hot"},{default:c((()=>[(m(!0),r(v,null,d(K.slice(0,J.value),((a,e)=>(m(),r("div",{key:a.id,class:"style-container"},[h("h4",L,g(a.name),1),h("div",T,[(m(!0),r(v,null,d(Q[e],(a=>(m(),r("div",{key:a.id,class:"style"},[h("span",{class:"iconfont play",onMousedown:y((e=>{return s=a.id,H(),void U.push({name:"playlist",query:{id:s+""}});var s}),["prevent"])},"",40,P),u(o,{src:a.cover,loading:"lazy"},null,8,["src"]),h("span",null,g(a.name),1)])))),128))])])))),128)),u(C,{"is-loading":A.value},null,8,["is-loading"])])),_:1})])),_:1})],8,I)),[[p,V]])}}}),[["__scopeId","data-v-23e02f0b"]]);export{F as default};
