import{u as a}from"../element-plus/element-plus.372e8740.js";import{G as s,d as e,Z as l,i as t,c as n,P as o,V as i,U as r,u as m,O as u,o as c,a as p,z as g}from"../@vue/@vue.7ad02ad1.js";import{b as d}from"../vue-router/vue-router.47595bf3.js";import{a as v,b as h,n as y,e as f,d as j,o as _,p as b,i as R,j as L,q as E,r as w,_ as S}from"../../assets/index-2ea1dc3c.js";import{s as O}from"../pinia/pinia.07d51cb2.js";import{P as C}from"../PlayButton/PlayButton.37e50d1e.js";import{D as x}from"../DecoratedButton/DecoratedButton.f99c924f.js";import{_ as B}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.caaeb116.js";import{T as M}from"../Tab/Tab.558c13db.js";import{M as P}from"../Mv/Mv.5a4db018.js";import{A as z}from"../Albums/Albums.6f0d1d78.js";import{P as A}from"../PlayList/PlayList.538fdd35.js";import{L as I}from"../Loading/Loading.5fe17f61.js";import{S as T}from"../Singer/Singer.a5649643.js";import{N as U}from"../NoSearch/NoSearch.9fb5ba1e.js";import{O as k}from"../OnlineBatch/OnlineBatch.5708f426.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const N={class:"search-container scroll-container"},D={class:"song"},G={class:"header-operation"},V={class:"singers"},q=S(s({__name:"SearchView",setup(s){const S=v(),{loveMusicId:q,loveSongs:F}=O(S),H=e(!1),W=a=>{H.value=a},Z=()=>{K.forEach((a=>{a.isLove=!0;null==q.value.get(a.id)&&F.value.push(a)})),E(w.LOCAL,"loveSongs",F.value)},J=d().query.keyWord+"",K=l([]),Q=t((()=>new Map(K.map(((a,s)=>[a.id,s]))))),X=l([]),Y=l([]),$=l([]),aa=l([]),sa=l([]),ea=e(!1),la=g("firstLoading"),ta=g("hideScroll"),na=l([!1,!1,!1,!1,!1]),oa=a=>{ta(),"video"==a&&0==X.length?h((async()=>{try{const a=await y(1014,60,J),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:n}=a;X.push({id:s,name:e,image:l,artist:t[0].userName,playCount:n})}))}catch(a){f(j.ERROR,a.message)}ea.value=!1,na[0]=0==X.length}),ea):"mv"==a&&0==Y.length?h((async()=>{try{const a=await y(1004,60,J),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:n}=a;Y.push({id:s,name:e,image:l,artist:t,playCount:n})}))}catch(a){f(j.ERROR,a.message)}ea.value=!1,na[1]=0==Y.length}),ea):"album"==a&&0==$.length?h((async()=>{try{const a=await y(10,60,J),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:n}=a;$.push({id:s,name:e,cover:l,publishTime:_(t),artistId:n.id})}))}catch(a){f(j.ERROR,a.message)}ea.value=!1,na[2]=0==Y.length}),ea):"playList"==a&&0==aa.length?h((async()=>{try{const a=await y(1e3,60,J),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;aa.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){f(j.ERROR,a.message)}ea.value=!1,na[3]=0==Y.length}),ea):"singer"==a&&0==sa.length&&h((async()=>{try{const a=await y(100,60,J),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;sa.push({id:s,name:e,avatar:l,score:t})}))}catch(a){f(j.ERROR,a.message)}ea.value=!1,na[4]=0==Y.length}),ea)};return h((async()=>{try{const a=await y(1,100,J),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await b(a),{songs:l}=e;l.forEach((a=>{R([],K,a)})),L(a,K),S.initLoveMusic(K)}}catch(a){f(j.ERROR,a.message)}la.value=!1}),la),(s,e)=>{const l=a;return c(),n("div",N,[o(r(k,{songs:K,"song-id-mapper":m(Q),onCloseSelect:W},null,8,["songs","song-id-mapper"]),[[i,H.value]]),o(r(M,{onGetActive:oa,active:"song",class:"search-tab"},{content:u((()=>[r(l,{label:"歌曲",name:"song"},{default:u((()=>[p("div",D,[p("div",G,[r(C,{songs:K},null,8,["songs"]),r(x,{icon:"",onClick:Z,name:"全部收藏"}),r(x,{icon:"",name:"批量操作",onClick:e[0]||(e[0]=a=>H.value=!H.value)})]),r(B,{songs:K,"song-id-mapper":m(Q),height:"440px"},null,8,["songs","song-id-mapper"])])])),_:1}),r(l,{label:"视频",name:"video"},{default:u((()=>[r(I,{"is-loading":ea.value},null,8,["is-loading"]),o(r(U,null,null,512),[[i,na[0]]]),o(r(P,{mvs:X},null,8,["mvs"]),[[i,!na[0]]])])),_:1}),r(l,{label:"MV",name:"mv"},{default:u((()=>[r(I,{"is-loading":ea.value},null,8,["is-loading"]),o(r(U,null,null,512),[[i,na[1]]]),o(r(P,{mvs:Y},null,8,["mvs"]),[[i,!na[1]]])])),_:1}),r(l,{label:"专辑",name:"album"},{default:u((()=>[r(I,{"is-loading":ea.value},null,8,["is-loading"]),o(r(U,null,null,512),[[i,na[2]]]),o(r(z,{albums:$},null,8,["albums"]),[[i,!na[2]]])])),_:1}),r(l,{label:"歌单",name:"playList"},{default:u((()=>[r(I,{"is-loading":ea.value},null,8,["is-loading"]),o(r(U,null,null,512),[[i,na[3]]]),o(r(A,{playlists:aa},null,8,["playlists"]),[[i,!na[3]]])])),_:1}),r(l,{label:"歌手",name:"singer"},{default:u((()=>[r(I,{"is-loading":ea.value},null,8,["is-loading"]),o(r(U,null,null,512),[[i,na[4]]]),o(p("div",V,[r(T,{"singer-list":sa,"show-all-avatar":!1},null,8,["singer-list"])],512),[[i,!na[4]]])])),_:1})])),_:1},512),[[i,!H.value]])])}}}),[["__scopeId","data-v-66fdbc61"]]);export{q as default};
