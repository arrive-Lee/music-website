import{x as a}from"../element-plus/element-plus.f4dce189.js";import{G as s,ax as e,i as l,r as i,Z as n,c as t,P as o,V as r,U as c,u,a as m,T as g,a2 as p,O as v,z as d,o as h,F as f,a7 as y,S as b,n as j,aq as C}from"../@vue/@vue.59fec093.js";import{b as R,u as k}from"../vue-router/vue-router.2f940de9.js";import{s as w}from"../pinia/pinia.81428a33.js";import{t as z,g as E,a as S,u as L,b as _,D as x,v as O,e as T,d as P,w as I,x as M,i as U,j as A,P as N,y as B,z as G,s as q,A as F,_ as V}from"../../assets/index-7a645485.js";import{P as D,_ as H}from"../PlayButton/PlayButton.50f9c530.js";import{T as J}from"../Tab/Tab.20caf89a.js";import{O as W}from"../OnlineBatch/OnlineBatch.a77978fc.js";import{M as Z}from"../Mv/Mv.ab938afb.js";import{A as K}from"../Albums/Albums.248b141a.js";import{P as Q}from"../PlayList/PlayList.c7221958.js";import{S as X}from"../Singer/Singer.8480a22b.js";import{L as Y}from"../Loading/Loading.cfa60473.js";import{_ as $}from"../NoSearch/NoSearch.1467f795.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.c2bb539f.js";import"../@element-plus/@element-plus.189e73a2.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.c1293ab3.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.9249ff62.js";const aa={class:"search-container scroll-container"},sa=["src"],ea={class:"right-singer"},la={class:"singer-name"},ia={class:"singer-info"},na={class:"song"},ta={class:"header-operation"},oa={class:"lyric-container"},ra={class:"lyric-operation"},ca=["onClick"],ua=["onClick"],ma=["onClick"],ga=["onClick"],pa=["onClick"],va={class:"lyric-left"},da={class:"song-name"},ha={class:"is-vip iconfont"},fa={class:"lyric-center"},ya={class:"lyric-right"},ba=V(s({__name:"SearchView",setup(s){e((a=>({"4b5f631c":u(ja),"25f28b8c":u(ka),"6f7fed34":u(Ra),"0dc100aa":u(Ca),"3a9ebffe":u(wa),faffa392:u(za)})));const V=z(),{bgMode:ba}=w(V),ja=d("fontGray"),Ca=E().get("shadow"),Ra=E().get("fontColor"),ka=E().get("themeColor"),wa=l((()=>"skin"==ba.value?"rgba(220, 220, 220, 0.1)":"#ffffff"==(null==Ra?void 0:Ra.value)?"rgba(30, 30, 30, 0.2)":"rgba(220, 220, 220, 0.25)")),za=l((()=>"skin"==ba.value?"rgba(230, 230, 230, 0.25)":"#ffffff"==(null==Ra?void 0:Ra.value)?"rgba(30, 30, 30, 1)":"rgba(220, 220, 220, 0.8)")),Ea=k(),Sa=S(),{loveMusicId:La,loveSongs:_a}=w(Sa),xa=i(!1),Oa=a=>{xa.value=a},Ta=()=>{Fa.forEach((a=>{a.isLove=!0;null==La.value.get(a.id)&&_a.value.push(a)}))},Pa=L(),{songListId:Ia,songList:Ma,current:Ua,playProcess:Aa,playTime:Na,isPlay:Ba}=w(Pa),Ga=R().query.keyWord+"",qa=i("song"),Fa=n([]),Va=l((()=>new Map(Fa.map(((a,s)=>[a.id,s]))))),Da=n([]),Ha=n([]),Ja=n([]),Wa=n([]),Za=n([]),Ka=n([]),Qa=l((()=>Ka.length>0?Ka[0]:{name:"",avatar:"",id:"",score:"",albumSize:"",mvSize:""})),Xa=n([]),Ya=l((()=>new Map(Xa.map(((a,s)=>[a.id,s]))))),$a=i(!1),as=d("firstLoading"),ss=n([!1,!1,!1,!1,!1,!1,!1]),es=n([]),ls=i(1),is=l((()=>"song"==qa.value?30:10)),ns=l((()=>"song"==qa.value?Fa:Xa)),ts=l((()=>ns.value.slice((ls.value-1)*is.value,ls.value*is.value))),os=l((()=>"song"==qa.value?Fa.length:Xa.length)),rs=a=>{ls.value=a},cs=a=>{qa.value=a,"video"==a&&0==Da.length?_((async()=>{try{const a=await O(1014,100,Ga),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:i,playTime:n}=a;Da.push({id:s,name:e,image:l,artist:i[0].userName,playCount:n})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[0]=0==Da.length}),$a):"mv"==a&&0==Ha.length?_((async()=>{try{const a=await O(1004,100,Ga),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:i,playCount:n}=a;Ha.push({id:s,name:e,image:l,artist:i,playCount:n})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[1]=0==Ha.length}),$a):"album"==a&&0==Ja.length?_((async()=>{try{const a=await O(10,60,Ga),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:i,artist:n}=a;Ja.push({id:s,name:e,cover:l,publishTime:I(i),artistId:n.id})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[2]=0==Ja.length}),$a):"radio"==a&&0==Za.length?_((async()=>{try{const a=await O(1009,100,Ga),{result:{djRadios:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,playCount:i}=a;Za.push({name:e,id:s,image:l,playCount:i,creator:{nickname:"",avatarUrl:""},tag:[],description:""})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[3]=0==Za.length}),$a):"playList"==a&&0==Wa.length?_((async()=>{try{const a=await O(1e3,100,Ga),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:i}=a;Wa.push({id:s,name:e,image:l,playCount:i,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[4]=0==Wa.length}),$a):"lyric"==a&&0==Xa.length&&_((async()=>{try{const a=await O(1006,100,Ga),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await M(a),{songs:l}=e;l.forEach((a=>{es.push(3),U([],Xa,a)})),s.forEach(((a,s)=>{const{lyrics:{txt:e}}=a;Xa[s].lyric=e.split("\n")})),A(a,Xa),Sa.initLoveMusic(Fa)}}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{$a.value=!1}),500),ss[6]=0==Xa.length}),$a)};return _((async()=>{try{const a=await O(1,100,Ga),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await M(a),{songs:l}=e;l.forEach((a=>{U([],Fa,a)})),A(a,Fa),Sa.initLoveMusic(Fa)}}catch(a){T(P.ERROR,a.message)}try{const a=await O(100,100,Ga),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:i,albumSize:n,mvSize:t}=a;Ka.push({id:s,name:e,avatar:l,score:i,albumSize:n,mvSize:t})})),ss[5]=0==Ka.length}catch(a){T(P.ERROR,a.message)}as.value=!1}),as),(s,e)=>{const l=a,i=C("prevent");return h(),t("div",aa,[o(c(W,{songs:u(ts),"song-id-mapper":u(Va),onCloseSelect:Oa},null,8,["songs","song-id-mapper"]),[[r,xa.value]]),o(m("div",{class:"result-singer",onClick:e[1]||(e[1]=a=>u(Ea).push({name:"artist",query:{id:u(Qa).id,score:u(Qa).score}}))},[m("img",{src:u(Qa).avatar,class:"left-singer"},null,8,sa),m("div",ea,[m("h4",la,"歌手："+g(u(Qa).name),1),m("p",ia,[m("span",null,"专辑："+g(u(Qa).albumSize),1),m("span",null,"视频："+g(u(Qa).mvSize),1)])]),c(x,{name:u(Qa).isLove?"取消关注":"关注歌手",icon:u(Qa).isLove?"":"","icon-style":u(Qa).isLove?"color:#ff6a6a;":"",onClick:e[0]||(e[0]=p((a=>u(Sa).addLove(u(Qa),u(Sa).loveSinger,u(Sa).loveSingerId)),["stop"]))},null,8,["name","icon","icon-style"])],512),[[r,u(Qa).name]]),o(c(J,{onGetActive:cs,active:"song",class:"search-tab"},{content:v((()=>[c(l,{label:"歌曲",name:"song"},{default:v((()=>[m("div",na,[m("div",ta,[c(D,{songs:u(ts)},null,8,["songs"]),c(x,{icon:"",onClick:Ta,name:"全部收藏"}),c(x,{icon:"",name:"批量操作",onClick:e[2]||(e[2]=a=>xa.value=!xa.value)})]),c(H,{songs:u(ts),"page-size":u(is),"song-id-mapper":u(Va)},null,8,["songs","page-size","song-id-mapper"]),o(c(N,{"cur-page":ls.value,"page-size":u(is),total:u(os),onPageChange:rs},null,8,["cur-page","page-size","total"]),[[r,u(is)<u(os)]])])])),_:1}),c(l,{label:"视频",name:"video"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[0]]]),o(c(Z,{mvs:Da,"show-pagination":!0},null,8,["mvs"]),[[r,!ss[0]]])])),_:1}),c(l,{label:"MV",name:"mv"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[1]]]),o(c(Z,{mvs:Ha,"show-pagination":!0},null,8,["mvs"]),[[r,!ss[1]]])])),_:1}),c(l,{label:"专辑",name:"album"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[2]]]),o(c(K,{albums:Ja,"show-pagination":!0},null,8,["albums"]),[[r,!ss[2]]])])),_:1}),c(l,{label:"电台",name:"radio"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[3]]]),o(c(Q,{playlists:Za,"show-pagination":!0,type:"radio"},null,8,["playlists"]),[[r,!ss[3]]])])),_:1}),c(l,{label:"歌单",name:"playList"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[4]]]),o(c(Q,{playlists:Wa,"show-pagination":!0},null,8,["playlists"]),[[r,!ss[4]]])])),_:1}),c(l,{label:"歌手",name:"singer"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[5]]]),o(c(X,{"singer-list":Ka},null,8,["singer-list"]),[[r,!ss[5]]])])),_:1}),c(l,{label:"歌词",name:"lyric"},{default:v((()=>[c(Y,{"is-loading":$a.value},null,8,["is-loading"]),o(c($,{text:"暂无搜索结果"},null,512),[[r,ss[6]]]),m("div",oa,[(h(!0),t(f,null,y(u(ts),(a=>{var s;return h(),t("div",{class:"lyric",key:a.id},[m("div",ra,[o((h(),t("span",{class:"iconfont play-music",onClick:s=>(async a=>{if("0"==a.available||"8"==a.available){const s=Ia.value.get(a.id);null==s?(Sa.addRecord(a,Sa.songRecord,Sa.loveMusicId),0==Ua.value?(Ba&&(Ba.value=!1),Aa.value=0,Na.value=0,Ma.value.unshift(a),await j(),Ba.value=!0):(Ma.value.unshift(a),Ua.value=0)):Ua.value!=s?Ua.value=s:Ba.value=!0}else"1"==a.available?T(P.INFO,"此歌曲为vip专属"):"10"==a.available&&T(P.INFO,"此歌曲尚未拥有版权，请切换其它歌曲")})(a)},[b("")],8,ca)),[[i]]),o((h(),t("span",{class:"iconfont music-info",onClick:s=>u(B)(a)},[b("")],8,ua)),[[i]]),o((h(),t("span",{class:"iconfont",onClick:s=>u(G)(a)},[b("")],8,ma)),[[i]]),o((h(),t("span",{class:"open-lyric",onClick:s=>{return e=u(Ya).get(a.id),void(es[e]=es[e]==Xa[e].lyric.length?3:Xa[e].lyric.length);var e}},[b(g(es[u(Ya).get(a.id)]==(null==(s=a.lyric)?void 0:s.length)?"收起歌词":"展开歌词"),1)],8,ga)),[[i]]),o((h(),t("span",{class:"copy-lyric",onClick:s=>u(q)(a.name+"\r\n"+a.lyric.join("\r\n"),"歌词复制成功！")},[b("复制歌词")],8,pa)),[[i]])]),m("div",va,[m("p",da,[m("span",null,g(a.name),1),o(m("span",ha,"",512),[[r,"10"==a.available||"1"==a.available]])]),(h(!0),t(f,null,y(a.lyric,((s,e)=>o((h(),t("p",{key:e},g(s.trim()),1)),[[r,e<es[u(Ya).get(a.id)]]]))),128))]),m("div",fa,[m("span",null,g(a.singer),1)]),m("div",ya,[m("span",null,g(a.album),1),m("span",null,g(u(F)(a.time)),1)])])})),128)),o(c(N,{class:"lyric-pagination","cur-page":ls.value,"page-size":u(is),total:u(os),onPageChange:rs},null,8,["cur-page","page-size","total"]),[[r,u(is)<u(os)]])])])),_:1})])),_:1},512),[[r,!xa.value]])])}}}),[["__scopeId","data-v-77b607a0"]]);export{ba as default};
