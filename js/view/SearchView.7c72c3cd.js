import{u as a}from"../element-plus/element-plus.372e8740.js";import{_ as s}from"../SongList.vue_vue_type_style_index_0_lang/SongList.vue_vue_type_style_index_0_lang.c55d4d0f.js";import{G as e,d as l,Z as t,c as n,U as o,O as i,o as r,a as u,P as c,V as m,n as p,z as v}from"../@vue/@vue.7ad02ad1.js";import{b as g}from"../vue-router/vue-router.53ff932e.js";import{a as d,u as h,c as y,p as f,f as j,h as _,q as b,r as L,k as E,l as R,e as S,s as C,_ as w}from"../../assets/index-4587ef8d.js";import{P as k}from"../PlayButton/PlayButton.482123dc.js";import{D as O}from"../DecoratedButton/DecoratedButton.d102c5e0.js";import{T as P}from"../Tab/Tab.30909498.js";import{M as x}from"../Mv/Mv.7d2a1764.js";import{A as I}from"../Albums/Albums.8fa81d4d.js";import{P as A}from"../PlayList/PlayList.c20e3470.js";import{L as M}from"../Loading/Loading.294eacb5.js";import{S as T}from"../Singer/Singer.3b22fb95.js";import{N as U}from"../NoSearch/NoSearch.092acb3e.js";import{s as z}from"../pinia/pinia.07d51cb2.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.5f7505c4.js";import"../@element-plus/@element-plus.cef41b68.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.6b07a04c.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.8c6d26c7.js";const N={class:"search-container scroll-container"},B={class:"song"},D={class:"top-operation"},G={class:"top-operation operation-select"},V={class:"singers"},q=w(e({__name:"SearchView",setup(e){const w=d(),{loveMusicId:q,loveSongs:F}=z(w),W=h(),{isPlay:Z,songList:H,songListId:J,playProcess:K,playTime:Q,current:X}=z(W),Y=l(!1);let $=t([]);const aa=a=>{$=t([]),$.push(...a)},sa=async()=>{$.length>0?(Z.value=!1,K.value=0,Q.value=0,await p(),$.forEach((a=>{null==J.value.get(a.id)&&H.value.unshift(a)})),X.value=J.value.get($[0].id),Z.value=!0,j(_.SUCCESS,"已添加到播放列表！")):j(_.INFO,"请添加歌曲！")},ea=()=>{$.forEach((a=>{w.addMuiscDownload(a)}))},la=()=>{oa.forEach((a=>{a.isLove=!0;null==q.value.get(a.id)&&F.value.push(a)})),S(C.LOCAL,"loveSongs",F.value)},ta=()=>{$.forEach((a=>{a.isLove=!0;null==q.value.get(a.id)&&F.value.push(a)})),S(C.LOCAL,"loveSongs",F.value)},na=g().query.keyWord+"",oa=t([]),ia=t([]),ra=t([]),ua=t([]),ca=t([]),ma=t([]),pa=l(!1),va=v("firstLoading"),ga=v("hideScroll"),da=t([!1,!1,!1,!1,!1]),ha=a=>{ga(),"video"==a&&0==ia.length?y((async()=>{try{const a=await f(1014,60,na),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:t,playTime:n}=a;ia.push({id:s,name:e,image:l,artist:t[0].userName,playCount:n})}))}catch(a){j(_.ERROR,a.message)}pa.value=!1,da[0]=0==ia.length}),pa):"mv"==a&&0==ra.length?y((async()=>{try{const a=await f(1004,60,na),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:t,playCount:n}=a;ra.push({id:s,name:e,image:l,artist:t,playCount:n})}))}catch(a){j(_.ERROR,a.message)}pa.value=!1,da[1]=0==ra.length}),pa):"album"==a&&0==ua.length?y((async()=>{try{const a=await f(10,60,na),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:t,artist:n}=a;ua.push({id:s,name:e,cover:l,publishTime:b(t),artistId:n.id})}))}catch(a){j(_.ERROR,a.message)}pa.value=!1,da[2]=0==ra.length}),pa):"playList"==a&&0==ca.length?y((async()=>{try{const a=await f(1e3,60,na),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:t}=a;ca.push({id:s,name:e,image:l,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){j(_.ERROR,a.message)}pa.value=!1,da[3]=0==ra.length}),pa):"singer"==a&&0==ma.length&&y((async()=>{try{const a=await f(100,60,na),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:t}=a;ma.push({id:s,name:e,avatar:l,score:t})}))}catch(a){j(_.ERROR,a.message)}pa.value=!1,da[4]=0==ra.length}),pa)};return y((async()=>{try{const a=await f(1,100,na),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await L(a),{songs:l}=e;l.forEach((a=>{E([],oa,a)})),R(a,oa),w.initLoveMusic(oa)}}catch(a){j(_.ERROR,a.message)}va.value=!1}),va),(e,l)=>{const t=s,p=a;return r(),n("div",N,[o(P,{onGetActive:ha,active:"song",class:"search-tab"},{content:i((()=>[o(p,{label:"歌曲",name:"song"},{default:i((()=>[u("div",B,[c(u("div",D,[o(k,{songs:oa},null,8,["songs"]),o(O,{icon:"",onClick:la,name:"全部收藏"}),o(O,{icon:"",name:"批量操作",onClick:l[0]||(l[0]=a=>Y.value=!Y.value)})],512),[[m,!Y.value]]),c(u("div",G,[o(O,{icon:"",name:"播放",class:"play",onClick:sa}),o(O,{icon:"",name:"收藏",onClick:ta}),o(O,{icon:"󰌄",onClick:ea,name:"下载"}),o(O,{icon:"",name:"取消操作",onClick:l[1]||(l[1]=a=>Y.value=!Y.value)})],512),[[m,Y.value]]),o(t,{songs:oa,showSelect:Y.value,onGetSelectItems:aa,height:"440px"},null,8,["songs","showSelect"])])])),_:1}),o(p,{label:"视频",name:"video"},{default:i((()=>[o(M,{"is-loading":pa.value},null,8,["is-loading"]),c(o(U,null,null,512),[[m,da[0]]]),c(o(x,{mvs:ia},null,8,["mvs"]),[[m,!da[0]]])])),_:1}),o(p,{label:"MV",name:"mv"},{default:i((()=>[o(M,{"is-loading":pa.value},null,8,["is-loading"]),c(o(U,null,null,512),[[m,da[1]]]),c(o(x,{mvs:ra},null,8,["mvs"]),[[m,!da[1]]])])),_:1}),o(p,{label:"专辑",name:"album"},{default:i((()=>[o(M,{"is-loading":pa.value},null,8,["is-loading"]),c(o(U,null,null,512),[[m,da[2]]]),c(o(I,{albums:ua},null,8,["albums"]),[[m,!da[2]]])])),_:1}),o(p,{label:"歌单",name:"playList"},{default:i((()=>[o(M,{"is-loading":pa.value},null,8,["is-loading"]),c(o(U,null,null,512),[[m,da[3]]]),c(o(A,{playlists:ca},null,8,["playlists"]),[[m,!da[3]]])])),_:1}),o(p,{label:"歌手",name:"singer"},{default:i((()=>[o(M,{"is-loading":pa.value},null,8,["is-loading"]),c(o(U,null,null,512),[[m,da[4]]]),c(u("div",V,[o(T,{"singer-list":ma,"show-all-avatar":!1},null,8,["singer-list"])],512),[[m,!da[4]]])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-c08be87e"]]);export{q as default};
