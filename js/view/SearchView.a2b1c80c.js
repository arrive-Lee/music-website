import{u as a}from"../element-plus/element-plus.a3a17194.js";import{P as s}from"../Pagination/Pagination.bf0a1aff.js";import{G as e,ax as l,i,r as n,Z as t,c as o,P as r,V as c,U as u,u as m,a as p,T as g,a2 as v,O as d,z as h,o as f,F as y,a7 as b,S as j,n as R,aq as C}from"../@vue/@vue.59fec093.js";import{b as k,u as S}from"../vue-router/vue-router.2f940de9.js";import{s as E}from"../pinia/pinia.81428a33.js";import{t as L,g as w,a as z,u as _,b as x,v as O,e as T,d as P,w as I,x as M,i as U,j as B,y as A,z as N,s as D,A as F,_ as G}from"../../assets/index-2ba49c67.js";import{P as q,_ as V}from"../PlayButton/PlayButton.a3003f23.js";import{T as J}from"../Tab/Tab.1d9be74c.js";import{O as K}from"../OnlineBatch/OnlineBatch.f80222dc.js";import{D as W}from"../DecoratedButton/DecoratedButton.353b9b06.js";import{M as Z}from"../Mv/Mv.8740b021.js";import{A as H}from"../Albums/Albums.eebdf559.js";import{P as Q}from"../PlayList/PlayList.586e2b8d.js";import{S as X}from"../Singer/Singer.586d777f.js";import{L as Y}from"../Loading/Loading.b53e31f5.js";import{_ as $}from"../NoSearch/NoSearch.cb414777.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.c2bb539f.js";import"../@element-plus/@element-plus.189e73a2.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.c1293ab3.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.9249ff62.js";const aa={class:"search-container scroll-container"},sa=["src"],ea={class:"right-singer"},la={class:"singer-name"},ia={class:"singer-info"},na={class:"song"},ta={class:"header-operation"},oa={class:"lyric-container"},ra={class:"lyric-operation"},ca=["onClick"],ua=["onClick"],ma=["onClick"],pa=["onClick"],ga=["onClick"],va={class:"lyric-left"},da={class:"song-name"},ha={class:"is-vip iconfont"},fa={class:"lyric-center"},ya={class:"lyric-right"},ba=G(e({__name:"SearchView",setup(e){l((a=>({"3714f92a":m(ja),"2b4b96f2":m(ka),a95ecd08:m(Ca),"34f02bf3":m(Ra),"3f754ab9":m(Sa),"41764e22":m(Ea)})));const G=L(),{bgMode:ba}=E(G),ja=h("fontGray"),Ra=w().get("shadow"),Ca=w().get("fontColor"),ka=w().get("themeColor"),Sa=i((()=>"skin"==ba.value?"rgba(220, 220, 220, 0.1)":"#ffffff"==(null==Ca?void 0:Ca.value)?"rgba(30, 30, 30, 0.2)":"rgba(220, 220, 220, 0.25)")),Ea=i((()=>"skin"==ba.value?"rgba(230, 230, 230, 0.25)":"#ffffff"==(null==Ca?void 0:Ca.value)?"rgba(30, 30, 30, 1)":"rgba(220, 220, 220, 0.8)")),La=S(),wa=z(),{loveMusicId:za,loveSongs:_a}=E(wa),xa=n(!1),Oa=a=>{is(),xa.value=a},Ta=()=>{Fa.forEach((a=>{a.isLove=!0;null==za.value.get(a.id)&&_a.value.push(a)}))},Pa=_(),{songListId:Ia,songList:Ma,current:Ua,playProcess:Ba,playTime:Aa,isPlay:Na}=E(Pa),Da=k().query.keyWord+"",Fa=t([]),Ga=i((()=>new Map(Fa.map(((a,s)=>[a.id,s]))))),qa=n(1),Va=n(50),Ja=i((()=>Fa.slice((qa.value-1)*Va.value,qa.value*Va.value))),Ka=i((()=>Fa.length)),Wa=a=>{qa.value=a},Za=t([]),Ha=t([]),Qa=t([]),Xa=t([]),Ya=t([]),$a=t([]),as=i((()=>$a.length>0?$a[0]:{name:"",avatar:"",id:"",score:"",albumSize:"",mvSize:""})),ss=t([]),es=n(!1),ls=h("firstLoading"),is=h("hideScroll"),ns=t([!1,!1,!1,!1,!1,!1,!1]),ts=t([]),os=a=>{is(),"video"==a&&0==Za.length?x((async()=>{try{const a=await O(1014,60,Da),{result:{videos:s}}=a;s&&s.length>0&&s.forEach((a=>{const{vid:s,title:e,coverUrl:l,creator:i,playTime:n}=a;Za.push({id:s,name:e,image:l,artist:i[0].userName,playCount:n})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[0]=0==Za.length}),es):"mv"==a&&0==Ha.length?x((async()=>{try{const a=await O(1004,60,Da),{result:{mvs:s}}=a;s&&0!=s.length&&s.forEach((a=>{const{id:s,name:e,cover:l,artistName:i,playCount:n}=a;Ha.push({id:s,name:e,image:l,artist:i,playCount:n})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[1]=0==Ha.length}),es):"album"==a&&0==Qa.length?x((async()=>{try{const a=await O(10,60,Da),{result:{albums:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,publishTime:i,artist:n}=a;Qa.push({id:s,name:e,cover:l,publishTime:I(i),artistId:n.id})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[2]=0==Qa.length}),es):"radio"==a&&0==Ya.length?x((async()=>{try{const a=await O(1009,60,Da),{result:{djRadios:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,playCount:i}=a;Ya.push({name:e,id:s,image:l,playCount:i,creator:{nickname:"",avatarUrl:""},tag:[],description:""})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[3]=0==Ya.length}),es):"playList"==a&&0==Xa.length?x((async()=>{try{const a=await O(1e3,60,Da),{result:{playlists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,coverImgUrl:l,playCount:i}=a;Xa.push({id:s,name:e,image:l,playCount:i,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[4]=0==Xa.length}),es):"lyric"==a&&0==ss.length&&x((async()=>{try{const a=await O(1006,60,Da),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await M(a),{songs:l}=e;l.forEach((a=>{ts.push(3),U([],ss,a)})),s.forEach(((a,s)=>{const{lyrics:{txt:e}}=a;ss[s].lyric=e.split("\n")})),B(a,ss),wa.initLoveMusic(Fa)}}catch(a){T(P.ERROR,a.message)}setTimeout((()=>{es.value=!1}),500),ns[6]=0==ss.length}),es)};return x((async()=>{try{const a=await O(1,100,Da),{result:{songs:s}}=a;if(s&&s.length>0){const a=s.map((a=>a.id)).join(","),e=await M(a),{songs:l}=e;l.forEach((a=>{U([],Fa,a)})),B(a,Fa),wa.initLoveMusic(Fa)}}catch(a){T(P.ERROR,a.message)}try{const a=await O(100,60,Da),{result:{artists:s}}=a;s&&s.length>0&&s.forEach((a=>{const{id:s,name:e,picUrl:l,accountId:i,albumSize:n,mvSize:t}=a;$a.push({id:s,name:e,avatar:l,score:i,albumSize:n,mvSize:t})})),ns[5]=0==$a.length}catch(a){T(P.ERROR,a.message)}ls.value=!1}),ls),(e,l)=>{const i=s,n=a,t=C("prevent");return f(),o("div",aa,[r(u(K,{songs:m(Ja),"song-id-mapper":m(Ga),onCloseSelect:Oa},null,8,["songs","song-id-mapper"]),[[c,xa.value]]),r(p("div",{class:"result-singer",onClick:l[1]||(l[1]=a=>m(La).push({name:"artist",query:{id:m(as).id,score:m(as).score}}))},[p("img",{src:m(as).avatar,class:"left-singer"},null,8,sa),p("div",ea,[p("h4",la,"歌手："+g(m(as).name),1),p("p",ia,[p("span",null,"专辑："+g(m(as).albumSize),1),p("span",null,"视频："+g(m(as).mvSize),1)])]),u(W,{name:m(as).isLove?"取消关注":"关注歌手",icon:m(as).isLove?"":"","icon-style":m(as).isLove?"color:#ff6a6a;":"",onClick:l[0]||(l[0]=v((a=>m(wa).addLove(m(as),m(wa).loveSinger,m(wa).loveSingerId)),["stop"]))},null,8,["name","icon","icon-style"])],512),[[c,m(as).name]]),r(u(J,{onGetActive:os,active:"song",class:"search-tab"},{content:d((()=>[u(n,{label:"歌曲",name:"song"},{default:d((()=>[p("div",na,[p("div",ta,[u(q,{songs:m(Ja)},null,8,["songs"]),u(W,{icon:"",onClick:Ta,name:"全部收藏"}),u(W,{icon:"",name:"批量操作",onClick:l[2]||(l[2]=a=>xa.value=!xa.value)})]),u(V,{songs:m(Ja),"song-id-mapper":m(Ga)},null,8,["songs","song-id-mapper"]),r(u(i,{"cur-page":qa.value,"page-size":Va.value,total:m(Ka),onPageChange:Wa},null,8,["cur-page","page-size","total"]),[[c,Va.value<m(Ka)]])])])),_:1}),u(n,{label:"视频",name:"video"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[0]]]),r(u(Z,{mvs:Za},null,8,["mvs"]),[[c,!ns[0]]])])),_:1}),u(n,{label:"MV",name:"mv"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[1]]]),r(u(Z,{mvs:Ha},null,8,["mvs"]),[[c,!ns[1]]])])),_:1}),u(n,{label:"专辑",name:"album"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[2]]]),r(u(H,{albums:Qa},null,8,["albums"]),[[c,!ns[2]]])])),_:1}),u(n,{label:"电台",name:"radio"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[3]]]),r(u(Q,{playlists:Ya,type:"radio"},null,8,["playlists"]),[[c,!ns[3]]])])),_:1}),u(n,{label:"歌单",name:"playList"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[4]]]),r(u(Q,{playlists:Xa},null,8,["playlists"]),[[c,!ns[4]]])])),_:1}),u(n,{label:"歌手",name:"singer"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[5]]]),r(u(X,{"singer-list":$a},null,8,["singer-list"]),[[c,!ns[5]]])])),_:1}),u(n,{label:"歌词",name:"lyric"},{default:d((()=>[u(Y,{"is-loading":es.value},null,8,["is-loading"]),r(u($,{text:"暂无搜索结果"},null,512),[[c,ns[6]]]),p("div",oa,[(f(!0),o(y,null,b(ss,((a,s)=>{var e;return f(),o("div",{class:"lyric",key:a.id},[p("div",ra,[r((f(),o("span",{class:"iconfont play-music",onClick:s=>(async a=>{if("0"==a.available||"8"==a.available){const s=Ia.value.get(a.id);null==s?(wa.addRecord(a,wa.songRecord,wa.loveMusicId),0==Ua.value?(Na&&(Na.value=!1),Ba.value=0,Aa.value=0,Ma.value.unshift(a),await R(),Na.value=!0):(Ma.value.unshift(a),Ua.value=0)):Ua.value!=s?Ua.value=s:Na.value=!0}else"1"==a.available?T(P.INFO,"此歌曲为vip专属"):"10"==a.available&&T(P.INFO,"此歌曲尚未拥有版权，请切换其它歌曲")})(a)},[j("")],8,ca)),[[t]]),r((f(),o("span",{class:"iconfont music-info",onClick:s=>m(A)(a)},[j("")],8,ua)),[[t]]),r((f(),o("span",{class:"iconfont",onClick:s=>m(N)(a)},[j("")],8,ma)),[[t]]),r((f(),o("span",{class:"open-lyric",onClick:a=>(a=>{ts[a]=ts[a]==ss[a].lyric.length?3:ss[a].lyric.length})(s)},[j(g(ts[s]==(null==(e=a.lyric)?void 0:e.length)?"收起歌词":"展开歌词"),1)],8,pa)),[[t]]),r((f(),o("span",{class:"copy-lyric",onClick:s=>m(D)(a.name+"\r\n"+a.lyric.join("\r\n"),"歌词复制成功！")},[j("复制歌词")],8,ga)),[[t]])]),p("div",va,[p("p",da,[p("span",null,g(a.name),1),r(p("span",ha,"",512),[[c,"10"==a.available||"1"==a.available]])]),(f(!0),o(y,null,b(a.lyric,((a,e)=>r((f(),o("p",{key:e},g(a.trim()),1)),[[c,e<ts[s]]]))),128))]),p("div",fa,[p("span",null,g(a.singer),1)]),p("div",ya,[p("span",null,g(a.album),1),p("span",null,g(m(F)(a.time)),1)])])})),128))])])),_:1})])),_:1},512),[[c,!xa.value]])])}}}),[["__scopeId","data-v-40c1d914"]]);export{ba as default};
