import{z as e,A as a,l as o}from"../element-plus/element-plus.f4dce189.js";import{G as s,ax as l,r as t,i as n,e as i,M as r,O as d,I as c,u,z as p,n as g,o as v,R as m,U as h,a as f,a2 as b,T as w,c as C,P as S,S as I,V as y,aq as M,ay as k,az as _}from"../@vue/@vue.59fec093.js";import{s as x}from"../pinia/pinia.81428a33.js";import{o as z}from"../vue-router/vue-router.2f940de9.js";import{t as L,g as j,u as H,a as P,e as B,d as N,j as O,a2 as R,A,a3 as E,_ as F}from"../../assets/index-c28fd0ea.js";const q=["onMousedown","textContent"],D={key:0,class:"iconfont vip"},G=["onClick"],T=["onClick"],U=["onClick"],$=s({__name:"SongList",props:{songs:null,songIdMapper:null,height:null,showSelect:{type:Boolean},sort:{default:void 0},isCancelSort:{type:Boolean,default:!1},showHeader:{type:Boolean,default:!0},pageSize:{default:0}},emits:["getSelectItems"],setup(o,{emit:s}){const k=o;l((e=>({"5161ec5c":u($),"6a0e948c":u(V),"501aa087":u(J),"27fc2614":u(K),"7f1b315c":u(Q)})));const _=L(),{bgMode:F}=x(_),$=j().get("fontColor"),V=j().get("tableHover"),J=j().get("background"),K=p("fontGray"),Q=j().get("themeColor"),W=p("hideScroll"),X=H(),{songList:Y,current:Z,isPlay:ee,playProcess:ae,playTime:oe,songListId:se}=x(X),le=P(),te=t(),ne=n((()=>k.showSelect)),ie=n((()=>k.showSelect?55:0)),re=e=>{s("getSelectItems",e)};i(ne,(e=>{e||te.value.clearSelection()}));const de=n((()=>k.sort?k.sort:[!1,!1,!1,!1])),ce=n((()=>k.isCancelSort)),ue=(e,a)=>e.name.localeCompare(a.name),pe=(e,a)=>e.singer.localeCompare(a.singer),ge=(e,a)=>e.album.localeCompare(a.album),ve=(e,a)=>+e.time-+a.time;i(ce,(e=>{e&&te.value.clearSort()}));const me=()=>document.querySelectorAll(`.operation${k.showHeader}`),he=e=>{let a=0;if(k.pageSize>0){const o=Math.floor(k.songIdMapper.get(e.id)/k.pageSize);a=k.songIdMapper.get(e.id)-o*k.pageSize}else a=k.songIdMapper.get(e.id);const o=me()[a];o&&(o.style.opacity="1")},fe=e=>{let a=0;if(k.pageSize>0){const o=Math.floor(k.songIdMapper.get(e.id)/k.pageSize);a=k.songIdMapper.get(e.id)-o*k.pageSize}else a=k.songIdMapper.get(e.id);const o=me()[a];o&&(o.style.opacity="0")},be=async e=>{if("0"==e.available||"8"==e.available){const a=se.value.get(e.id);null==a?(le.addRecord(e,le.songRecord,le.songRecordId),0==Z.value?(ee&&(ee.value=!1),ae.value=0,oe.value=0,Y.value.unshift(e),await g(),ee.value=!0):(Y.value.unshift(e),Z.value=0)):Z.value!=a?Z.value=a:ee.value=!0}else"1"==e.available?B(N.INFO,"此歌曲为vip专属"):"10"==e.available&&B(N.INFO,"此歌曲尚未拥有版权，请切换其它歌曲")};let we=0;return we=setInterval((()=>{if(k.songs.length>0){const e=k.songs.map((e=>e.id)),a=k.songs.findIndex((e=>e.id==Y.value[Z.value].id));e.length>0&&O(e.join(","),k.songs,"",a)}}),3e5),z((()=>{clearInterval(we)})),(s,l)=>{const t=a,n=M("prevent");return v(),r(u(e),{onCellDblclick:be,onCellMouseEnter:he,onCellMouseLeave:fe,onSelectionChange:re,data:o.songs,"max-height":o.height,"show-header":o.showHeader,ref_key:"tableContainer",ref:te,style:{width:"80vw"},class:c(["songs-table",{"skin-table":"skin"==u(F)}])},{default:d((()=>[u(ne)?(v(),r(t,{key:0,type:"selection",width:u(ie)},null,8,["width"])):m("",!0),h(t,{sortable:u(de)[0],"sort-method":ue,label:"歌曲",width:500-u(ie)},{default:d((e=>[f("div",null,[f("span",{onMousedown:b((a=>u(le).addLove(e.row,u(le).loveSongs,u(le).loveMusicId)),["prevent"]),class:c(["iconfont love",{"is-love":e.row.isLove}]),textContent:w(e.row.isLove?"󰅅":"")},null,42,q),f("span",null,w(e.row.name),1),"1"==e.row.available||"10"==e.row.available?(v(),C("span",D,"")):m("",!0),S((v(),C("span",{class:"iconfont playmv",onClick:a=>{return o=e.row,void E(o,(()=>{W()}));var o}},[I("")],8,G)),[[n]]),f("div",{class:c(`operation-area operation${o.showHeader}`)},[S((v(),C("span",{onClick:a=>be(e.row),class:"iconfont"},[I("")],8,T)),[[y,!u(ee)||u(Z)!=u(Y).findIndex((a=>a.id==e.row.id))],[n]]),S((v(),C("span",{onClick:l[0]||(l[0]=e=>ee.value=!1),class:"iconfont"},[I(" ")])),[[y,u(ee)&&u(Z)==u(Y).findIndex((a=>a.id==e.row.id))],[n]]),S((v(),C("span",{class:"iconfont",onClick:a=>u(le).addMuiscDownload(e.row)},[I("󰌄")],8,U)),[[n]]),h(R,{song:e.row,play:be},null,8,["song"])],2)])])),_:1},8,["sortable","width"]),h(t,{sortable:u(de)[1],"sort-method":pe,prop:"singer",label:"歌手",width:"320"},null,8,["sortable"]),h(t,{sortable:u(de)[2],"sort-method":ge,prop:"album",label:"专辑",width:"320"},null,8,["sortable"]),h(t,{sortable:u(de)[3],"sort-method":ve,label:"时长"},{default:d((e=>[f("span",null,w(u(A)(e.row.time)),1)])),_:1},8,["sortable"])])),_:1},8,["data","max-height","show-header","class"])}}}),V=(e=>(k("data-v-cbb4b56a"),e=e(),_(),e))((()=>f("span",{class:"iconfont"},"",-1))),J=F(s({__name:"PlayButton",props:{songs:null,name:{default:"播放全部"}},setup(e){const a=e;l((e=>({"0425d13f":u(t),"3beef406":u(s)})));const s=j().get("shadow"),t=j().get("themeColor"),n=H(),{songList:i,current:c,songNum:p,songListId:g}=x(n),m=()=>{if(a.songs.length>0){const e=p.value;a.songs.forEach((e=>{null!=g.value.get(e.id)||"0"!=e.available&&"8"!=e.available||i.value.push(e)})),c.value=e,B(N.SUCCESS,"已经添加到播放列表")}else B(N.INFO,"请添加歌曲")};return(a,s)=>{const l=o;return v(),r(l,{onClick:m},{default:d((()=>[V,I(w(e.name),1)])),_:1})}}}),[["__scopeId","data-v-cbb4b56a"]]);export{J as P,$ as _};
