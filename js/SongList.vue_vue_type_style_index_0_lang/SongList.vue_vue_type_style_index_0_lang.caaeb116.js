import{y as e,z as a}from"../element-plus/element-plus.372e8740.js";import{G as o,ax as s,d as l,i as t,e as n,M as r,O as i,u as d,n as u,o as c,R as p,U as v,a as m,a2 as g,I as h,T as w,c as b,P as f,S as y,V as C,z as I,aq as S}from"../@vue/@vue.7ad02ad1.js";import{g as k,u as M,a as x,e as L,d as j,j as _,K as R,L as B,M as H}from"../../assets/index-2ea1dc3c.js";import{s as N}from"../pinia/pinia.07d51cb2.js";import{o as O}from"../vue-router/vue-router.47595bf3.js";const P=["onMousedown","textContent"],q={key:0,class:"iconfont vip"},z=["onClick"],D=["onClick"],F=["onClick"],T=o({__name:"SongList",props:{songs:null,songIdMapper:null,height:null,showSelect:{type:Boolean},sort:{default:void 0},isCancelSort:{type:Boolean,default:!1},showHeader:{type:Boolean,default:!0}},emits:["getSelectItems"],setup(o,{emit:T}){const A=o;s((e=>({a7dd1e32:d(E),a74fea80:d(K),bf764d7e:d(G)})));const E=k().get("fontColor"),G=k().get("background"),K=k().get("tableHover"),U=I("hideScroll"),V=M(),{songList:J,current:Q,isPlay:W,playProcess:X,playTime:Y,songListId:Z}=N(V),$=x(),ee=l(),ae=l("operation-area operation"+Number.parseInt(1e12*Math.random()+"")),oe=t((()=>A.showSelect)),se=t((()=>A.showSelect?55:0)),le=e=>{T("getSelectItems",e)};n(oe,(e=>{e||ee.value.clearSelection()}));const te=t((()=>A.sort?A.sort:[!1,!1,!1,!1])),ne=t((()=>A.isCancelSort)),re=(e,a)=>e.name.localeCompare(a.name),ie=(e,a)=>e.singer.localeCompare(a.singer),de=(e,a)=>e.album.localeCompare(a.album),ue=(e,a)=>+e.time-+a.name;n(ne,(e=>{e&&ee.value.clearSort()}));const ce=()=>document.querySelectorAll("."+ae.value.split(" ")[1]),pe=e=>{ce()[A.songIdMapper.get(e.id)].style.opacity="1"},ve=e=>{ce()[A.songIdMapper.get(e.id)].style.opacity="0"},me=async e=>{if("0"==e.available||"8"==e.available){const a=Z.value.get(e.id);null==a?($.addRecord(e,$.songRecord,$.songRecordId,"songRecord"),0==Q.value?(W&&(W.value=!1),X.value=0,Y.value=0,J.value.unshift(e),await u(),W.value=!0):(J.value.unshift(e),Q.value=0)):Q.value!=a?Q.value=a:W.value=!0}else(e.available="1")?L(j.INFO,"此歌曲为vip专属"):(e.available="10")&&L(j.INFO,"此歌曲尚未拥有版权，请切换其它歌曲")};let ge=0;return ge=setInterval((()=>{const e=A.songs.map((e=>e.id)),a=A.songs.findIndex((e=>e.id==J.value[Q.value].id));e.length>0&&_(e.join(","),A.songs,"",a)}),3e5),O((()=>{clearInterval(ge)})),(s,l)=>{const t=a,n=S("prevent");return c(),r(d(e),{onCellDblclick:me,onCellMouseEnter:pe,onCellMouseLeave:ve,onSelectionChange:le,data:o.songs,"max-height":o.height,"show-header":o.showHeader,ref_key:"tableContainer",ref:ee,style:{width:"80vw"},class:"songs-table"},{default:i((()=>[d(oe)?(c(),r(t,{key:0,type:"selection",width:d(se)},null,8,["width"])):p("",!0),v(t,{sortable:d(te)[0],"sort-method":re,label:"歌曲",width:500-d(se)},{default:i((e=>[m("div",null,[m("span",{onMousedown:g((a=>d($).addLove(e.row,d($).loveSongs,d($).loveMusicId,"loveSongs")),["prevent"]),class:h(["iconfont love",{"is-love":e.row.isLove}]),textContent:w(e.row.isLove?"󰅅":"")},null,42,P),m("span",null,w(e.row.name),1),"1"==e.row.available||"10"==e.row.available?(c(),b("span",q,"")):p("",!0),f((c(),b("span",{class:"iconfont playmv",onClick:a=>{return o=e.row,void H(o,(()=>{U()}));var o}},[y("")],8,z)),[[n]]),m("div",{class:h(ae.value)},[f((c(),b("span",{onClick:a=>me(e.row),class:"iconfont"},[y("")],8,D)),[[C,!d(W)||d(Q)!=d(J).findIndex((a=>a.id==e.row.id))],[n]]),f((c(),b("span",{onClick:l[0]||(l[0]=e=>W.value=!1),class:"iconfont"},[y(" ")])),[[C,d(W)&&d(Q)==d(J).findIndex((a=>a.id==e.row.id))],[n]]),f((c(),b("span",{class:"iconfont",onClick:a=>d($).addMuiscDownload(e.row)},[y("󰌄")],8,F)),[[n]]),v(R,{song:e.row,play:me},null,8,["song"])],2)])])),_:1},8,["sortable","width"]),v(t,{sortable:d(te)[1],"sort-method":ie,prop:"singer",label:"歌手",width:"320"},null,8,["sortable"]),v(t,{sortable:d(te)[2],"sort-method":de,prop:"album",label:"专辑",width:"320"},null,8,["sortable"]),v(t,{sortable:d(te)[3],"sort-method":ue,label:"时长"},{default:i((e=>[m("span",null,w(d(B)(e.row.time)),1)])),_:1},8,["sortable"])])),_:1},8,["data","max-height","show-header"])}}});export{T as _};
